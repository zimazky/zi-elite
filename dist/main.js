(()=>{"use strict";var t={752:(t,e,i)=>{const s=i(331),o=i(764),n=i(24),r=i(115),a=i(421),h=i(100),l=i(704),u=i(385),c=i(270),d=i(193),m=i(460);e.Z=async function(){const t=document.getElementById("info"),e=new r.Engine("glcanvas");let i,y,g,M,f,w,p,x,b,E,v,z,S,_,T,R,I=0,D=0;(0,a.initKeyBuffer)();const L=await(0,m.loadImage)("textures/gray_noise.png"),V=await(0,m.loadImage)("textures/blue_noise.png"),P=await(0,m.loadImage)("textures/starmap_2020_16k_gal.jpg"),U=await(0,m.loadImage)("textures/constellation_figures_8k_gal.jpg"),A=new c.TerrainSampler(new h.NoiseSampler(L)),O=localStorage.getItem("ziEliteData")??"{}";console.log("localStorage",O);const N=JSON.parse(O);let C=d.Vec3.ZERO(),j=l.Quaternion.Identity();void 0!==N.position&&(C=new d.Vec3(N.position.x,N.position.y,N.position.z)),void 0!==N.orientation&&(j=new l.Quaternion(N.orientation.x,N.orientation.y,N.orientation.z,N.orientation.w));const k=new o.Camera(C,j,A),K=new s.Atmosphere,Z=new u.Sky;e.onProgramInit=t=>{i=e.getUniformLocation(t,"uCameraPosition"),y=e.getUniformLocation(t,"uCameraViewAngle"),g=e.getUniformLocation(t,"uCameraVelocity"),M=e.getUniformLocation(t,"uCameraDirection"),f=e.getUniformLocation(t,"uTransformMat"),w=e.getUniformLocation(t,"uCameraRotationSpeed"),b=e.getUniformLocation(t,"uCameraInShadow"),_=e.getUniformLocation(t,"uHeadLight"),E=e.getUniformLocation(t,"uSunDirection"),z=e.getUniformLocation(t,"uSunDiscColor"),v=e.getUniformLocation(t,"uSunDiscAngleSin"),e.gl.uniform1f(v,n.SUN_DISC_ANGLE_SIN),T=e.getUniformLocation(t,"uSkyTransformMat"),S=e.getUniformLocation(t,"uSkyColor"),R=e.getUniformLocation(t,"uConstellationsColor"),p=e.getUniformLocation(t,"uScreenMode"),x=e.getUniformLocation(t,"uMapScale");const s=e.setTexture(t,"uTextureGrayNoise",L,0),o=e.setTexture(t,"uTextureBlueNoise",V,1),r=e.setTexture(t,"uTextureMilkyway",P,2),a=e.setTexture(t,"uTextureConstellation",U,3);e.gl.activeTexture(e.gl.TEXTURE0),e.gl.bindTexture(e.gl.TEXTURE_2D,s),e.gl.activeTexture(e.gl.TEXTURE1),e.gl.bindTexture(e.gl.TEXTURE_2D,o),e.gl.activeTexture(e.gl.TEXTURE2),e.gl.bindTexture(e.gl.TEXTURE_2D,r),e.gl.activeTexture(e.gl.TEXTURE3),e.gl.bindTexture(e.gl.TEXTURE_2D,a)},e.onProgramLoop=(s,o)=>{k.loopCalculation(s,o),e.gl.uniform4f(i,k.position.x,k.position.y,k.position.z,k.altitude),e.gl.uniform3f(g,k.velocity.x,k.velocity.y,k.velocity.z),e.gl.uniform3f(w,k.angularSpeed.x,k.angularSpeed.y,k.angularSpeed.z),e.gl.uniform3f(M,k.direction.x,k.direction.y,k.direction.z);const r=[k.transformMat.i.x,k.transformMat.i.y,k.transformMat.i.z,k.transformMat.j.x,k.transformMat.j.y,k.transformMat.j.z,k.transformMat.k.x,k.transformMat.k.y,k.transformMat.k.z];e.gl.uniformMatrix3fv(f,!1,r),e.gl.uniform1f(y,k.viewAngle),e.gl.uniform2f(p,k.screenMode,k.mapMode),e.gl.uniform1f(x,k.mapScale),Z.loopCalculation(s,o);const a=[Z.transformMat.i.x,Z.transformMat.i.y,Z.transformMat.i.z,Z.transformMat.j.x,Z.transformMat.j.y,Z.transformMat.j.z,Z.transformMat.k.x,Z.transformMat.k.y,Z.transformMat.k.z];e.gl.uniformMatrix3fv(T,!1,a),e.gl.uniform1f(R,Z.isShowConstellations?1:0);const h=k.inShadow(K,k.position,Z.sunDirection);if(e.gl.uniform3f(E,Z.sunDirection.x,Z.sunDirection.y,Z.sunDirection.z),e.gl.uniform1f(b,h),e.gl.uniform3f(_,k.headLights,k.headLights,k.headLights),s>I){const i=1e3*o,r=k.velocity.length(),a=3.6*r,h=e.canvas.width.toFixed(0),l=e.canvas.height.toFixed(0),u=new d.Vec3(k.position.x,0,k.position.z),c=Z.sunDirection.copy();c.y<0&&(c.y=0),c.normalizeMutable();const m=K.scattering(u,c,c),y=n.SUN_COLOR.mul(10),g=y.mulEl(m.t).safeNormalize().mulMutable(10);e.gl.uniform3f(z,g.x,g.y,g.z);const M=K.scattering(u,d.Vec3.J(),Z.sunDirection),f=y.mulEl(M.t).mulMutable(4*Math.PI).addMutable(new d.Vec3(.001,.001,.001));e.gl.uniform3f(S,f.x,f.y,f.z),t.innerText=`dt: ${i.toFixed(2)} fps: ${(1e3/i).toFixed(2)} ${h}x${l}\n      v: ${r.toFixed(2)}m/s (${a.toFixed(2)}km/h)\n      alt: ${k.altitude.toFixed(2)} h: ${k.position.y.toFixed(2)}\n      x: ${k.position.x.toFixed(2)} y: ${k.position.z.toFixed(2)}\n      sun: ${g.x.toFixed(2)}, ${g.y.toFixed(2)}, ${g.z.toFixed(2)}\n      sky: ${f.x.toFixed(2)}, ${f.y.toFixed(2)}, ${f.z.toFixed(2)}`,I=s+.5}if(s>D){const t=JSON.stringify({position:k.position,orientation:k.orientation});localStorage.setItem("ziEliteData",t),D=s+5}},e.start()}},331:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Atmosphere=void 0;const s=i(921),o=i(193),n=(o.Vec3.ZERO(),6371e3),r=40589641e6,a=41873841e6;e.Atmosphere=class{constructor(){this.betaRayleigh=new o.Vec3(55e-7,13e-6,224e-7),this.betaMie=o.Vec3.ONE().mulMutable(2e-7),this.betaAbsorption=new o.Vec3(204e-7,497e-7,195e-8),this.g=.996,this.heightRayleigh=8e3,this.heightMie=1200,this.heightAbsorption=3e4,this.absorptionFallof=4e3}ChH(t,e,i){const s=1.2533*Math.sqrt(t+e);if(i>=0)return s/(s*i+1)*Math.exp(-e);{const o=Math.sqrt(1-i*i)*(t+e);return 1.2533*Math.sqrt(o)*2*Math.exp(t-o)-s/(1-s*i)*Math.exp(-e)}}softPlanetShadow(t,e){const i=new o.Vec3(0,t.y+n,0),r=i.dot(e),a=Math.sqrt(i.dot(i)-r*r);if(r>0)return 1;const h=(n-a)/r;return(0,s.smoothstep)(-.008725,.008725,h)}scattering(t,e,i){const s=new o.Vec3(0,t.y+n,0);let h=s.dot(s),l=-s.dot(e);const u=h-l*l;if(u>=a)return{t:o.Vec3.ZERO(),i:o.Vec3.ONE()};const c=Math.sqrt(a-u);let d=2*c;if(h>a){if(l<0)return{t:o.Vec3.ZERO(),i:o.Vec3.ONE()};s.addMutable(e.mul(l-c)),h=a,l=c}else d=c-s.dot(e);let m=!1;s.normalize().dot(e)<0&&u<r&&(d=l-Math.sqrt(r-u),m=!0);const y=e.dot(i),g=y*y,M=this.g*this.g,f=.75*(1+g),w=m?0:1.5*(1-M)/(2+M)*(1+g)/Math.pow(1+M-2*y*this.g,1.5),p=d/32,x=e.mul(p),b=s.add(x.mul(.5));let E=0,v=0,z=0;const S=o.Vec3.ZERO(),_=o.Vec3.ZERO();for(let t=0;t<32;t++){const t=b.length()-n,e=p*Math.exp(-t/this.heightRayleigh),s=p*Math.exp(-t/this.heightMie),o=(this.heightAbsorption-t)/this.absorptionFallof;E+=e,v+=s,z+=e/(o*o+1);const a=b.dot(i),h=b.dot(b)-a*a;if(a>0||h>r){const t=b.normalize().dot(i),o=b.length()-n,r=this.heightRayleigh*this.ChH(n/this.heightRayleigh,o/this.heightRayleigh,t),a=this.heightMie*this.ChH(n/this.heightMie,o/this.heightMie,t),h=0,l=this.betaRayleigh.mul(-E-r).addMutable(this.betaMie.mul(-v-a)).addMutable(this.betaAbsorption.mul(-z-h)).exp();S.addMutable(l.mul(e)),_.addMutable(l.mul(s))}b.addMutable(x)}const T=m?this.betaRayleigh.mul(-E).addMutable(this.betaAbsorption.mul(-z)).exp():this.betaRayleigh.mul(-E).addMutable(this.betaMie.mul(-v)).addMutable(this.betaAbsorption.mul(-z)).exp();return{t:this.betaRayleigh.mulEl(S).mulMutable(f).addMutable(this.betaMie.mulEl(_).mulMutable(w)).divMutable(4*Math.PI),i:T}}}},764:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Camera=void 0;const s=i(421),o=i(704),n=i(193),r=new n.Vec3(.01,.05,.001).mulMutable(58),a=Math.PI/180;e.Camera=class{constructor(t,e,i){this.direction=new n.Vec3(0,0,-1),this.headLights=0,this.position=t.copy(),this.velocity=n.Vec3.ZERO(),this.angularSpeed=n.Vec3.ZERO(),this.orientation=e,this.viewAngle=80*Math.PI/180,this.tSampler=i,this.screenMode=0,this.mapMode=0,this.mapScale=1}inShadow(t,e,i){const s=t.softPlanetShadow(e,i);if(s<=.001)return 0;const o=s*this.tSampler.softShadow(this.position,i);return Math.pow(o,4)}loopCalculation(t,e){const i=new n.Vec3(0,0,(0,s.isKeyDown)(83)-(0,s.isKeyDown)(87)),h=this.orientation.mat3();this.transformMat=h,this.velocity.addMutable(h.mul(i).mulMutable(11*e)),this.velocity.subMutable(h.mul(h.mulLeft(this.velocity).mulElMutable(r)).mulMutable(e)),this.velocity.y-=0*e,(0,s.isKeyDown)(32)>0&&(this.velocity=n.Vec3.ZERO()),this.position.addMutable(this.velocity.mul(e));const l=this.tSampler.terrainM(new n.Vec2(this.position.x,this.position.z))+2;this.position.y<l&&(this.velocity.y=0,this.position.y=l),this.altitude=this.position.y-l;const u=new n.Vec3((0,s.isKeyDown)(40)-(0,s.isKeyDown)(38),(0,s.isKeyDown)(188)-(0,s.isKeyDown)(190),2*((0,s.isKeyDown)(37)-(0,s.isKeyDown)(39)));this.angularSpeed.addMutable(u.mulMutable(3*a*e)),this.angularSpeed.subMutable(this.angularSpeed.mul(3*e));const c=this.angularSpeed.mul(.5);this.orientation=this.orientation.qmul(new o.Quaternion(0,0,Math.sin(c.z),Math.cos(c.z))),this.orientation=this.orientation.qmul(new o.Quaternion(Math.sin(c.x),0,0,Math.cos(c.x))),this.orientation=this.orientation.qmul(new o.Quaternion(0,Math.sin(c.y),0,Math.cos(c.y))),this.orientation.normalizeMutable(),this.direction=this.orientation.rotate(new n.Vec3(0,0,-1)),(0,s.isKeyPress)(77)>0&&(this.screenMode=0==this.screenMode?1:0),1==this.screenMode?(this.mapScale*=1+.01*((0,s.isKeyDown)(109)+(0,s.isKeyDown)(189)-(0,s.isKeyDown)(107)-(0,s.isKeyDown)(187)),(0,s.isKeyPress)(71)>0&&(this.mapMode^=1),(0,s.isKeyPress)(72)>0&&(this.mapMode^=2)):this.viewAngle+=.01*((0,s.isKeyDown)(109)-(0,s.isKeyDown)(107)),(0,s.isKeyPress)(76)>0&&(this.headLights=0==this.headLights?1e3:0)}}},24:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.SUN_COLOR=e.SUN_DISC_ANGLE_SIN=void 0;const s=i(193);e.SUN_DISC_ANGLE_SIN=.008725,e.SUN_COLOR=new s.Vec3(.942,1.0269,1.0241)},115:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Engine=void 0;const s=i(318),o=i(240);class n extends s.GLContext{constructor(t){super(t),this.onProgramInit=t=>{},this.onProgramLoop=(t,e)=>{}}async loadShader(t){let e=await fetch(t);return await e.text()}async start(){const t=(0,o.preprocess)("shaders","vs.glsl"),e=await(0,o.preprocess)("shaders","fs.glsl");console.log(e);const i=this.createProgram(await t,e);this.gl.useProgram(i),this.createBuffer();const s=this.gl.getAttribLocation(i,"aVertexPosition");this.gl.enableVertexAttribArray(s),this.gl.vertexAttribPointer(s,2,this.gl.FLOAT,!1,0,0),this.resolutionUniform=this.gl.getUniformLocation(i,"uResolution"),this.timeUniform=this.gl.getUniformLocation(i,"uTime"),this.onProgramInit(i),this.startTime=this.currentTime=performance.now()/1e3,this.loop()}createBuffer(){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.gl.createBuffer()),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array([1,1,-1,1,1,-1,-1,-1]),this.gl.STATIC_DRAW)}resizeCanvasToDisplaySize(){if(void 0===this.canvas)return;const t=window.innerWidth,e=window.innerHeight;this.canvas.width===t&&this.canvas.height===e||(this.canvas.width=t,this.canvas.height=e,this.gl.viewport(0,0,this.canvas.width,this.canvas.height))}getUniformLocation(t,e){return this.gl.getUniformLocation(t,e)}setTexture(t,e,i,s){const o=this.gl.createTexture();this.gl.bindTexture(this.gl.TEXTURE_2D,o),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.REPEAT),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.REPEAT),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,i);const n=this.gl.getUniformLocation(t,e);return this.gl.uniform1i(n,s),o}loop(){this.resizeCanvasToDisplaySize();const t=performance.now()/1e3,e=t-this.startTime,i=t-this.currentTime;this.currentTime=t,this.gl.uniform2f(this.resolutionUniform,this.canvas.width,this.canvas.height),this.gl.uniform2f(this.timeUniform,e,i),this.onProgramLoop(e,i),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4),requestAnimationFrame(this.loop.bind(this))}}e.Engine=n},318:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.GLContext=void 0,e.GLContext=class{constructor(t){if(void 0!==t){if(this.canvas=document.getElementById(t),void 0===this.canvas)throw new Error("Cannot find element named: "+t)}else this.canvas=document.createElement("canvas"),document.body.appendChild(this.canvas);if(this.gl=this.canvas.getContext("webgl2"),!this.gl)throw new Error("Unable to initialize WebGL. Your browser or machine may not support it.")}createShader(t,e){const i=this.gl.createShader(t);return this.gl.shaderSource(i,e.trim()),this.gl.compileShader(i),this.gl.getShaderParameter(i,this.gl.COMPILE_STATUS)?i:(alert("Error compiling shader: "+this.gl.getShaderInfoLog(i)),this.gl.deleteShader(i),null)}createProgram(t,e){const i=this.createShader(this.gl.VERTEX_SHADER,t),s=this.createShader(this.gl.FRAGMENT_SHADER,e),o=this.gl.createProgram();return this.gl.attachShader(o,i),this.gl.attachShader(o,s),this.gl.linkProgram(o),this.gl.getProgramParameter(o,this.gl.LINK_STATUS)?o:(alert("Unable to initialize the shader program: "+this.gl.getProgramInfoLog(o)),null)}}},421:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.isKeyDown=e.isKeyPress=e.initKeyBuffer=void 0;const i=256,s=Array(i).fill(0);function o(t){t.keyCode>=i||(s[t.keyCode]=1,t.preventDefault())}function n(t){t.keyCode>=i||(s[t.keyCode]=0,t.preventDefault())}e.initKeyBuffer=function(){window.addEventListener("keydown",o,!1),window.addEventListener("keyup",n,!1)},e.isKeyPress=function(t){const e=s[t];return s[t]=0,e},e.isKeyDown=function(t){return s[t]}},921:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.rad=e.smoothstep=void 0,e.smoothstep=function(t,e,i){if(i<t)return 0;if(i>=e)return 1;const s=(i-t)/(e-t);return s*s*(3-2*s)},e.rad=function(t){return Math.PI*t/180}},100:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.NoiseSampler=void 0;const s=i(193);e.NoiseSampler=class{constructor(t){const e=document.createElement("canvas");e.width=t.width,e.height=t.height;const i=e.getContext("2d");i.drawImage(t,0,0,t.width,t.height),this._data=i.getImageData(0,0,e.width,e.height)}getSample(t){const e=t.fract(),i=Math.floor(e.x*this._data.width),s=Math.floor(e.y*this._data.height);return this._data.data[s*this._data.width+i<<2]/255}noiseD(t){const e=t.floor(),i=t.copy().subMutable(e),o=new s.Vec2(3,3).subMutable(i.mul(2)).mulElMutable(i).mulElMutable(i),n=new s.Vec2(1,1).subMutable(i).mulElMutable(i).mulMutable(6),r=this.getSample(new s.Vec2(.5,.5).addMutable(e).divMutable(256)),a=this.getSample(new s.Vec2(1.5,.5).addMutable(e).divMutable(256)),h=this.getSample(new s.Vec2(.5,1.5).addMutable(e).divMutable(256)),l=this.getSample(new s.Vec2(1.5,1.5).addMutable(e).divMutable(256));return{value:r+(a-r)*o.x+(h-r)*o.y+(r-a-h+l)*o.x*o.y,derivative:new s.Vec2(n.x*(o.y*(r-a-h+l)+a-r),n.y*(o.x*(r-a-h+l)+h-r))}}}},704:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Quaternion=void 0;const s=i(193);class o extends s.Vec4{invert(){return new o(-this.x,-this.y,-this.z,this.w).divMutable(this.dot(this))}qmul(t){return new o(this.w*t.x+this.x*t.w+this.y*t.z-this.z*t.y,this.w*t.y+this.y*t.w+this.z*t.x-this.x*t.z,this.w*t.z+this.z*t.w+this.x*t.y-this.y*t.x,this.w*t.w-this.x*t.x-this.y*t.y-this.z*t.z)}rotate(t){const e=new o(t.x,t.y,t.z,0),i=this.qmul(e).qmul(this.invert());return new s.Vec3(i.x,i.y,i.z)}mat3(){return new s.Mat3(this.rotate(s.Vec3.I()),this.rotate(s.Vec3.J()),this.rotate(s.Vec3.K()))}static byAngle(t,e){const i=.5*e,s=t.mul(Math.sin(i));return new o(s.x,s.y,s.z,Math.cos(i))}static byYawPitchRoll(t,e,i){return o.byAngle(s.Vec3.I(),e).qmul(o.byAngle(s.Vec3.J(),t).qmul(o.byAngle(s.Vec3.K(),i)))}}e.Quaternion=o,o.Identity=()=>new o(0,0,0,1)},240:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.preprocess=void 0,e.preprocess=async function t(e,i,s=0){if(s>10)throw new Error("Превышено возможное количество уровней вложения модулей программы");const o=(await async function(t){let e=await fetch(t);return await e.text()}(e+"/"+i)).split("\n").map((async i=>{if(i.startsWith("#include")){const[o,n]=i.split(/\s/,2);return await t(e,n.replace(/["']/g,""),s+1)}return i}));return(await Promise.all(o)).join("\n")}},385:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Sky=void 0;const s=i(704),o=i(193),n=i(421),r=.12*Math.PI;e.Sky=class{constructor(){this.quat=s.Quaternion.byAngle(o.Vec3.I(),.5*Math.PI),this.axis=new o.Vec3(0,Math.cos(r),-Math.sin(r)),this.period=1200,this.sunDir=new o.Vec3(0,-Math.sin(r),-Math.cos(r)),this.orientation=s.Quaternion.Identity(),this.transformMat=o.Mat3.ID(),this.isShowConstellations=!1,this.sunDirection=this.sunDir.copy()}loopCalculation(t,e){this.orientation=s.Quaternion.byAngle(this.axis,-2*Math.PI*(.35+t/this.period)),this.transformMat=this.orientation.qmul(this.quat).mat3(),this.sunDirection=this.orientation.rotate(this.sunDir).normalize(),(0,n.isKeyPress)(67)>0&&(this.isShowConstellations=!this.isShowConstellations)}}},270:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.TerrainSampler=void 0;const s=i(24),o=i(921),n=i(193),r=new n.Mat2(new n.Vec2(.8,-.6),new n.Vec2(.6,.8)),a=3e3,h=1100;e.TerrainSampler=class{constructor(t){this._noiseSampler=t}terrainH(t){let e=t.div(a),i=0,s=1;const o=n.Vec2.ZERO();for(let t=0;t<16;t++){const t=this._noiseSampler.noiseD(e);o.addMutable(t.derivative),i+=s*t.value/(1+o.dot(o)),s*=.5,e=r.mul(e.add(e))}return h*i}terrainM(t){let e=t.div(a),i=0,s=1;const o=n.Vec2.ZERO();for(let t=0;t<9;t++){const t=this._noiseSampler.noiseD(e);o.addMutable(t.derivative),i+=s*t.value/(1+o.dot(o)),s*=.5,e=r.mul(e.add(e))}return h*i}terrainS(t){let e=t.div(a),i=0,s=1;const o=n.Vec2.ZERO();for(let t=0;t<5;t++){const t=this._noiseSampler.noiseD(e);o.addMutable(t.derivative),i+=s*t.value/(1+o.dot(o)),s*=.5,e=r.mul(e.add(e))}return h*i}softShadow(t,e){let i=1,r=.1;const a=Math.sqrt(1-e.z*e.z);for(let h=0;h<200;h++){const h=t.add(e.mul(r));if(h.y>1980)return(0,o.smoothstep)(-s.SUN_DISC_ANGLE_SIN,s.SUN_DISC_ANGLE_SIN,i);const l=h.y-this.terrainM(new n.Vec2(h.x,h.z));if(i=Math.min(i,a*l/r),i<-s.SUN_DISC_ANGLE_SIN)return(0,o.smoothstep)(-s.SUN_DISC_ANGLE_SIN,s.SUN_DISC_ANGLE_SIN,i);r+=Math.max(1,.6*Math.abs(l))}return 0}}},193:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Mat2=e.Vec2=e.Mat3=e.Vec3=e.Mat4=e.Vec4=void 0;class i{constructor(t,e,i,s){this.x=t,this.y=e,this.z=i,this.w=s}addMutable(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}subMutable(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}mulMutable(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}divMutable(t){return this.x/=t,this.y/=t,this.z/=t,this.w/=t,this}mulElMutable(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}divElMutable(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this.w/=t.w,this}normalizeMutable(){return this.divMutable(Math.sqrt(this.dot(this)))}add(t){return this.copy().addMutable(t)}sub(t){return this.copy().subMutable(t)}mul(t){return this.copy().mulMutable(t)}div(t){return this.copy().divMutable(t)}mulEl(t){return this.copy().mulElMutable(t)}divEl(t){return this.copy().divElMutable(t)}normalize(){return this.copy().normalizeMutable()}length(){return Math.sqrt(this.dot(this))}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}copy(){return new i(this.x,this.y,this.z,this.w)}floor(){return new i(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z),Math.floor(this.w))}fract(){return this.copy().subMutable(this.floor())}}e.Vec4=i,i.ZERO=()=>new i(0,0,0,0),i.ONE=()=>new i(1,1,1,1),i.I=()=>new i(1,0,0,0),i.J=()=>new i(0,1,0,0),i.K=()=>new i(0,0,1,0),i.L=()=>new i(0,0,0,1);class s{constructor(t,e,i,s){this.i=t.copy(),this.j=e.copy(),this.k=i.copy(),this.l=s.copy()}mulLeft(t){return new i(this.i.dot(t),this.j.dot(t),this.k.dot(t),this.j.dot(t))}mul(t){return new i(t.x*this.i.x+t.y*this.j.x+t.z*this.k.x+t.w*this.j.x,t.x*this.i.y+t.y*this.j.y+t.z*this.k.y+t.w*this.j.y,t.x*this.i.z+t.y*this.j.z+t.z*this.k.z+t.w*this.j.z,t.x*this.i.w+t.y*this.j.w+t.z*this.k.w+t.w*this.j.w)}}e.Mat4=s,s.ID=()=>new s(i.I(),i.J(),i.K(),i.L()),s.ZERO=()=>new s(i.ZERO(),i.ZERO(),i.ZERO(),i.ZERO());class o{constructor(t,e,i){this.x=t,this.y=e,this.z=i}addMutable(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}subMutable(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}mulMutable(t){return this.x*=t,this.y*=t,this.z*=t,this}divMutable(t){return this.x/=t,this.y/=t,this.z/=t,this}mulElMutable(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}divElMutable(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}normalizeMutable(){return this.divMutable(Math.sqrt(this.dot(this)))}safeNormalize(){const t=Math.sqrt(this.dot(this));return t<Number.MIN_VALUE?o.ZERO():this.div(t)}add(t){return this.copy().addMutable(t)}sub(t){return this.copy().subMutable(t)}mul(t){return this.copy().mulMutable(t)}div(t){return this.copy().divMutable(t)}mulEl(t){return this.copy().mulElMutable(t)}divEl(t){return this.copy().divElMutable(t)}normalize(){return this.copy().normalizeMutable()}length(){return Math.sqrt(this.dot(this))}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}copy(){return new o(this.x,this.y,this.z)}floor(){return new o(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z))}fract(){return this.copy().subMutable(this.floor())}exp(){return new o(Math.exp(this.x),Math.exp(this.y),Math.exp(this.z))}cross(t){return new o(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)}}e.Vec3=o,o.ZERO=()=>new o(0,0,0),o.ONE=()=>new o(1,1,1),o.I=()=>new o(1,0,0),o.J=()=>new o(0,1,0),o.K=()=>new o(0,0,1);class n{constructor(t,e,i){this.i=t.copy(),this.j=e.copy(),this.k=i.copy()}mulLeft(t){return new o(this.i.dot(t),this.j.dot(t),this.k.dot(t))}mul(t){return new o(t.x*this.i.x+t.y*this.j.x+t.z*this.k.x,t.x*this.i.y+t.y*this.j.y+t.z*this.k.y,t.x*this.i.z+t.y*this.j.z+t.z*this.k.z)}}e.Mat3=n,n.ID=()=>new n(o.I(),o.J(),o.K()),n.ZERO=()=>new n(o.ZERO(),o.ZERO(),o.ZERO());class r{constructor(t,e){this.x=t,this.y=e}addMutable(t){return this.x+=t.x,this.y+=t.y,this}subMutable(t){return this.x-=t.x,this.y-=t.y,this}mulMutable(t){return this.x*=t,this.y*=t,this}divMutable(t){return this.x/=t,this.y/=t,this}mulElMutable(t){return this.x*=t.x,this.y*=t.y,this}divElMutable(t){return this.x/=t.x,this.y/=t.y,this}normalizeMutable(){return this.divMutable(Math.sqrt(this.dot(this)))}add(t){return this.copy().addMutable(t)}sub(t){return this.copy().subMutable(t)}mul(t){return this.copy().mulMutable(t)}div(t){return this.copy().divMutable(t)}mulEl(t){return this.copy().mulElMutable(t)}divEl(t){return this.copy().divElMutable(t)}normalize(){return this.copy().normalizeMutable()}length(){return Math.sqrt(this.dot(this))}dot(t){return this.x*t.x+this.y*t.y}copy(){return new r(this.x,this.y)}floor(){return new r(Math.floor(this.x),Math.floor(this.y))}fract(){return this.copy().subMutable(this.floor())}cross(t){return this.x*t.y-this.y*t.x}}e.Vec2=r,r.ZERO=()=>new r(0,0),r.ONE=()=>new r(1,1),r.I=()=>new r(1,0),r.J=()=>new r(0,1);class a{constructor(t,e){this.i=t.copy(),this.j=e.copy()}mulLeft(t){return new r(this.i.dot(t),this.j.dot(t))}mul(t){return new r(t.x*this.i.x+t.y*this.j.x,t.x*this.i.y+t.y*this.j.y)}}e.Mat2=a,a.ID=()=>new a(r.I(),r.J()),a.ZERO=()=>new a(r.ZERO(),r.ZERO())},460:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.loadImage=void 0,e.loadImage=function(t){return new Promise(((e,i)=>{const s=new Image;s.onload=()=>e(s),s.onerror=()=>i(),s.src=t}))}}},e={};(0,function i(s){var o=e[s];if(void 0!==o)return o.exports;var n=e[s]={exports:{}};return t[s](n,n.exports,i),n.exports}(752).Z)()})();