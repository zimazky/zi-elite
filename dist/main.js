(()=>{"use strict";var t={752:(t,i,e)=>{const s=e(331),a=e(764),n=e(24),o=e(115),r=e(490),h=e(421),l=e(100),u=e(704),c=e(385),d=e(270),g=e(193),m=e(460);i.Z=async function(){const t=document.getElementById("info"),i=new o.Engine("glcanvas");let e,y,M,p,f,x,w,b,E,R,v,_,z,S,T,I,D,L,U,V,P,N,A,O,C,j,F,K=0,k=0;(0,h.initKeyBuffer)();const Z=await(0,m.loadImage)("textures/gray_noise.png"),q=await(0,m.loadImage)("textures/blue_noise.png"),X=await(0,m.loadImage)("textures/starmap_2020_16k_gal.jpg"),G=await(0,m.loadImage)("textures/constellation_figures_8k_gal.jpg"),B=new d.TerrainSampler(new l.NoiseSampler(Z)),$=localStorage.getItem("ziEliteData")??"{}";console.log("localStorage",$),JSON.parse($);let J=new g.Vec3(2316,0,7696),H=new u.Quaternion(0,-.9908125427905498,0,.13524239368232574);const W=new a.Camera(J,H,B),Q=new s.Atmosphere,Y=new c.Sky,tt=new r.Flare(W),it=new r.Flare(W);i.onProgramInit=t=>{e=i.gl.getUniformLocation(t,"uCameraPosition"),y=i.gl.getUniformLocation(t,"uCameraViewAngle"),M=i.gl.getUniformLocation(t,"uCameraVelocity"),p=i.gl.getUniformLocation(t,"uCameraDirection"),f=i.gl.getUniformLocation(t,"uTransformMat"),x=i.gl.getUniformLocation(t,"uCameraRotationSpeed"),E=i.gl.getUniformLocation(t,"uCameraInShadow"),P=i.gl.getUniformLocation(t,"uHeadLight"),O=i.gl.getUniformLocation(t,"uFlare1Position"),C=i.gl.getUniformLocation(t,"uFlare1Light"),j=i.gl.getUniformLocation(t,"uFlare2Position"),F=i.gl.getUniformLocation(t,"uFlare2Light"),R=i.gl.getUniformLocation(t,"uSunDirection"),_=i.gl.getUniformLocation(t,"uSunDiscColor"),v=i.gl.getUniformLocation(t,"uSunDiscAngleSin"),i.gl.uniform1f(v,n.SUN_DISC_ANGLE_SIN),S=i.gl.getUniformLocation(t,"uBetaRayleigh"),i.gl.uniform3f(S,Q.betaRayleigh.x,Q.betaRayleigh.y,Q.betaRayleigh.z),T=i.gl.getUniformLocation(t,"uBetaMie"),i.gl.uniform3f(T,Q.betaMie.x,Q.betaMie.y,Q.betaMie.z),I=i.gl.getUniformLocation(t,"uGMie"),i.gl.uniform1f(I,Q.g),D=i.gl.getUniformLocation(t,"uScaleHeight"),i.gl.uniform2f(D,Q.heightRayleigh,Q.heightMie),L=i.gl.getUniformLocation(t,"uAtmRadius"),i.gl.uniform1f(L,Q.radius),U=i.gl.getUniformLocation(t,"uPlanetRadius"),i.gl.uniform1f(U,Q.planetRadius),V=i.gl.getUniformLocation(t,"uPlanetCenter"),i.gl.uniform3f(V,Q.planetCenter.x,Q.planetCenter.y,Q.planetCenter.z),N=i.gl.getUniformLocation(t,"uSkyTransformMat"),z=i.gl.getUniformLocation(t,"uSkyColor"),A=i.gl.getUniformLocation(t,"uConstellationsColor"),w=i.gl.getUniformLocation(t,"uScreenMode"),b=i.gl.getUniformLocation(t,"uMapScale");const s=i.setTextureWithMIP(t,"uTextureGrayNoise",Z,0),a=i.setTexture(t,"uTextureBlueNoise",q,1),o=i.setTexture(t,"uTextureMilkyway",X,2),r=i.setTexture(t,"uTextureConstellation",G,3);i.gl.activeTexture(i.gl.TEXTURE0),i.gl.bindTexture(i.gl.TEXTURE_2D,s),i.gl.activeTexture(i.gl.TEXTURE1),i.gl.bindTexture(i.gl.TEXTURE_2D,a),i.gl.activeTexture(i.gl.TEXTURE2),i.gl.bindTexture(i.gl.TEXTURE_2D,o),i.gl.activeTexture(i.gl.TEXTURE3),i.gl.bindTexture(i.gl.TEXTURE_2D,r)},i.onProgramLoop=(s,a)=>{W.loopCalculation(s,a),i.gl.uniform4f(e,W.position.x,W.position.y,W.position.z,W.altitude),i.gl.uniform3f(M,W.velocity.x,W.velocity.y,W.velocity.z),i.gl.uniform3f(x,W.angularSpeed.x,W.angularSpeed.y,W.angularSpeed.z),i.gl.uniform3f(p,W.direction.x,W.direction.y,W.direction.z);const o=[W.transformMat.i.x,W.transformMat.i.y,W.transformMat.i.z,W.transformMat.j.x,W.transformMat.j.y,W.transformMat.j.z,W.transformMat.k.x,W.transformMat.k.y,W.transformMat.k.z];i.gl.uniformMatrix3fv(f,!1,o),i.gl.uniform1f(y,W.viewAngle),i.gl.uniform2f(w,W.screenMode,W.mapMode),i.gl.uniform1f(b,W.mapScale),Y.loopCalculation(s,a);const r=[Y.transformMat.i.x,Y.transformMat.i.y,Y.transformMat.i.z,Y.transformMat.j.x,Y.transformMat.j.y,Y.transformMat.j.z,Y.transformMat.k.x,Y.transformMat.k.y,Y.transformMat.k.z];i.gl.uniformMatrix3fv(N,!1,r),i.gl.uniform1f(A,Y.isShowConstellations?1:0);const h=W.inShadow(Q,W.position,Y.sunDirection);if(i.gl.uniform3f(R,Y.sunDirection.x,Y.sunDirection.y,Y.sunDirection.z),i.gl.uniform1f(E,h),i.gl.uniform3f(P,W.headLights,W.headLights,W.headLights),s>K){const e=1e3*a,o=W.velocity.length(),r=3.6*o,h=i.canvas.width.toFixed(0),l=i.canvas.height.toFixed(0),u=new g.Vec3(W.position.x,0,W.position.z),c=Y.sunDirection.copy();c.y<0&&(c.y=0),c.normalizeMutable();const d=Q.scattering(u,c,c),m=n.SUN_COLOR.mul(20),y=n.SUN_COLOR.mulEl(d.t),M=m.mulEl(d.t).safeNormalize().mulMutable(2);i.gl.uniform3f(_,M.x,M.y,M.z);const p=1/Math.sqrt(2),f=Q.scattering(u,g.Vec3.J(),Y.sunDirection).t.add(Q.scattering(u,new g.Vec3(p,p,0),Y.sunDirection).t).add(Q.scattering(u,new g.Vec3(-p,p,0),Y.sunDirection).t).add(Q.scattering(u,new g.Vec3(0,p,p),Y.sunDirection).t).add(Q.scattering(u,new g.Vec3(0,p,-p),Y.sunDirection).t).div(5),x=m.mulEl(f);i.gl.uniform3f(z,x.x,x.y,x.z),t.innerText=`dt: ${e.toFixed(2)} fps: ${(1e3/e).toFixed(2)} ${h}x${l}\n      v: ${o.toFixed(2)}m/s (${r.toFixed(2)}km/h)\n      alt: ${W.altitude.toFixed(2)} h: ${W.position.y.toFixed(2)}\n      x: ${W.position.x.toFixed(2)} y: ${W.position.z.toFixed(2)}\n      sunR: ${y.x.toFixed(2)}, ${y.y.toFixed(2)}, ${y.z.toFixed(2)}\n      sun: ${M.x.toFixed(2)}, ${M.y.toFixed(2)}, ${M.z.toFixed(2)}\n      sky: ${x.x.toFixed(2)}, ${x.y.toFixed(2)}, ${x.z.toFixed(2)}`,K=s+.5}if(s>k){const t=JSON.stringify({position:W.position,orientation:W.orientation});localStorage.setItem("ziEliteData",t),k=s+5}tt.update(s,a),i.gl.uniform3f(O,tt.position.x,tt.position.y,tt.position.z),tt.isVisible?i.gl.uniform3f(C,tt.light.x,tt.light.y,tt.light.z):i.gl.uniform3f(C,0,0,0),it.update(s,a),i.gl.uniform3f(j,it.position.x,it.position.y,it.position.z),it.isVisible?i.gl.uniform3f(F,it.light.x,it.light.y,it.light.z):i.gl.uniform3f(F,0,0,0)},i.start()}},331:(t,i,e)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.Atmosphere=void 0;const s=e(24),a=e(921),n=e(193),o=Math.PI*Math.PI*Math.PI,r=1.04345246,h=1/(4*Math.PI);i.Atmosphere=class{constructor(){this.planetRadius=6371e3,this.planetCenter=new n.Vec3(0,-this.planetRadius,0),this.radius=6471e3,this.n=1.00029,this.rgbLambda=new n.Vec3(615e-9,535e-9,445e-9),this.betaRayleigh=new n.Vec3(55e-7,13e-6,224e-7),this.betaMie=n.Vec3.ONE().mulMutable(2e-7),this.g=.996,this.p=.035,this.heightRayleigh=8e3,this.heightMie=1200,this.planetRadius2=this.planetRadius*this.planetRadius,this.radius2=this.radius*this.radius}computeBetaRayleigh(t){const i=this.n*this.n-1,e=t*t;return 8*o*i*i*(6+3*this.p)/(7512000000000001e10*e*e*(6-7*this.p))}ChHOld(t,i,e){const s=t+i,a=r*Math.sqrt(s),n=a*Math.exp(-i);if(e>=0)return n/(a*e+1);{const i=Math.sqrt(1-e*e)*s;return r*Math.sqrt(i)*2*Math.exp(t-i)-n/(1-a*e)}}ChH(t,i,e){const s=t+i,a=r*Math.sqrt(s),n=a*Math.exp(-i);if(e>=0)return n/((a-1)*e+1);{const i=Math.sqrt(1-e*e);return n/((a-1)*e-1)+2*a*Math.exp(t-s*i)*Math.sqrt(i)}}softPlanetShadow(t,i){const e=t.sub(this.planetCenter),n=e.dot(i),o=Math.sqrt(e.dot(e)-n*n);if(n>0)return 1;const r=(this.planetRadius-o)/n;return(0,a.smoothstep)(-s.SUN_DISC_ANGLE_SIN,s.SUN_DISC_ANGLE_SIN,r)}scattering(t,i,e){const s=t.sub(this.planetCenter);let a=s.dot(s),o=-s.dot(i);const r=a-o*o;if(r>=this.radius2)return{t:n.Vec3.ZERO(),i:n.Vec3.ONE()};const l=Math.sqrt(this.radius2-r);let u=2*l;if(a>this.radius2){if(o<0)return{t:n.Vec3.ZERO(),i:n.Vec3.ONE()};s.addMutable(i.mul(o-l)),a=this.radius2,o=l}else u=l-s.dot(i);let c=!1;s.normalize().dot(i)<0&&r<this.planetRadius2&&(u=o-Math.sqrt(this.planetRadius2-r),c=!0);const d=i.dot(e),g=d*d,m=this.g*this.g,y=.75*(1+g)*h,M=1.5*(1-m)/(2+m)*(1+g)/Math.pow(1+m-2*d*this.g,1.5)*h,p=u/32,f=i.mul(p),x=s.add(f),w=s.add(f.mul(.5));let b=0,E=0;const R=n.Vec3.ZERO(),v=n.Vec3.ZERO();let _=p*Math.exp(-(s.length()-this.planetRadius)/this.heightRayleigh),z=p*Math.exp(-(s.length()-this.planetRadius)/this.heightMie);for(let t=0;t<32;t++,x.addMutable(f),w.addMutable(f)){const t=x.length()-this.planetRadius,i=p*Math.exp(-t/this.heightRayleigh),s=p*Math.exp(-t/this.heightMie);b+=.5*(i+_),E+=.5*(s+z),_=i,z=s;const a=w.dot(e),n=w.dot(w)-a*a;if(a>0||n>this.planetRadius2){const t=w.normalize().dot(e),a=w.length()-this.planetRadius,n=this.heightRayleigh*this.ChH(this.planetRadius/this.heightRayleigh,a/this.heightRayleigh,t),o=this.heightMie*this.ChH(this.planetRadius/this.heightMie,a/this.heightMie,t),r=this.betaRayleigh.mul(-b-n).addMutable(this.betaMie.mul(-E-o)).exp();R.addMutable(r.mul(i)),v.addMutable(r.mul(s))}}const S=c?this.betaRayleigh.mul(-b).exp():this.betaRayleigh.mul(-b).addMutable(this.betaMie.mul(-E)).exp();return{t:this.betaRayleigh.mulEl(R).mulMutable(y).addMutable(this.betaMie.mulEl(v).mulMutable(M)),i:S}}transmittance(t,i){const e=t.sub(this.planetCenter);let s=e.dot(e),a=-e.dot(i);const o=s-a*a;if(o>=this.radius2)return n.Vec3.ZERO();const r=Math.sqrt(this.radius2-o);let l=2*r;if(s>this.radius2){if(a<0)return n.Vec3.ZERO();e.addMutable(i.mul(a-r)),s=this.radius2,a=r}else l=r-e.dot(i);let u=!1;e.normalize().dot(i)<0&&o<this.planetRadius2&&(l=a-Math.sqrt(this.planetRadius2-o));const c=this.g*this.g,d=1.5*h,g=1.5*(1-c)/(2+c)*2/Math.pow(1+c-2*this.g,1.5)*h,m=l/32,y=i.mul(m),M=e.add(y),p=e.add(y.mul(.5));let f=0,x=0;const w=n.Vec3.ZERO(),b=n.Vec3.ZERO();let E=m*Math.exp(-(e.length()-this.planetRadius)/this.heightRayleigh),R=m*Math.exp(-(e.length()-this.planetRadius)/this.heightMie);for(let t=0;t<32;t++,M.addMutable(y),p.addMutable(y)){const t=M.length()-this.planetRadius,i=m*Math.exp(-t/this.heightRayleigh),e=m*Math.exp(-t/this.heightMie);f+=.5*(i+E),x+=.5*(e+R),E=i,R=e;const s=this.betaRayleigh.mul(-f).addMutable(this.betaMie.mul(-x)).exp();w.addMutable(s.mul(i)),b.addMutable(s.mul(e))}return this.betaRayleigh.mulEl(w).mulMutable(d).addMutable(this.betaMie.mulEl(b).mulMutable(g))}}},764:(t,i,e)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.Camera=void 0;const s=e(421),a=e(704),n=e(193),o=new n.Vec3(.01,.05,.001).mulMutable(58),r=Math.PI/180;i.Camera=class{constructor(t,i,e){this.direction=new n.Vec3(0,0,-1),this.headLights=0,this.position=t.copy(),this.velocity=n.Vec3.ZERO(),this.angularSpeed=n.Vec3.ZERO(),this.orientation=i,this.viewAngle=80*Math.PI/180,this.tSampler=e,this.screenMode=0,this.mapMode=0,this.mapScale=1}inShadow(t,i,e){const s=t.softPlanetShadow(i,e);if(s<=.001)return 0;const a=s*this.tSampler.softShadow(this.position,e);return Math.pow(a,4)}loopCalculation(t,i){const e=new n.Vec3(0,0,(0,s.isKeyDown)(83)-(0,s.isKeyDown)(87)),h=this.orientation.mat3();this.transformMat=h,this.velocity.addMutable(h.mul(e).mulMutable(11*i)),this.velocity.subMutable(h.mul(h.mulLeft(this.velocity).mulElMutable(o)).mulMutable(i)),this.velocity.y-=0*i,(0,s.isKeyDown)(32)>0&&(this.velocity=n.Vec3.ZERO()),this.position.addMutable(this.velocity.mul(i));const l=this.tSampler.terrainM(new n.Vec2(this.position.x,this.position.z))+2;this.position.y<l&&(this.velocity.y=0,this.position.y=l),this.altitude=this.position.y-l;const u=new n.Vec3((0,s.isKeyDown)(40)-(0,s.isKeyDown)(38),(0,s.isKeyDown)(188)-(0,s.isKeyDown)(190),2*((0,s.isKeyDown)(37)-(0,s.isKeyDown)(39)));this.angularSpeed.addMutable(u.mulMutable(3*r*i)),this.angularSpeed.subMutable(this.angularSpeed.mul(3*i));const c=this.angularSpeed.mul(.5);this.orientation=this.orientation.qmul(new a.Quaternion(0,0,Math.sin(c.z),Math.cos(c.z))),this.orientation=this.orientation.qmul(new a.Quaternion(Math.sin(c.x),0,0,Math.cos(c.x))),this.orientation=this.orientation.qmul(new a.Quaternion(0,Math.sin(c.y),0,Math.cos(c.y))),this.orientation.normalizeMutable(),this.direction=this.orientation.rotate(new n.Vec3(0,0,-1)),(0,s.isKeyPress)(77)>0&&(this.screenMode=0==this.screenMode?1:0),1==this.screenMode?(this.mapScale*=1+.01*((0,s.isKeyDown)(109)+(0,s.isKeyDown)(189)-(0,s.isKeyDown)(107)-(0,s.isKeyDown)(187)),(0,s.isKeyPress)(71)>0&&(this.mapMode^=1),(0,s.isKeyPress)(72)>0&&(this.mapMode^=2)):this.viewAngle+=.01*((0,s.isKeyDown)(109)-(0,s.isKeyDown)(107)),(0,s.isKeyPress)(76)>0&&(this.headLights=0==this.headLights?100:0)}}},24:(t,i,e)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.SUN_COLOR=i.SUN_DISC_ANGLE_SIN=void 0;const s=e(193);i.SUN_DISC_ANGLE_SIN=.008725,i.SUN_COLOR=s.Vec3.ONE()},115:(t,i,e)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.Engine=void 0;const s=e(318),a=e(240);class n extends s.GLContext{constructor(t){super(t),this.onProgramInit=t=>{},this.onProgramLoop=(t,i)=>{}}async loadShader(t){let i=await fetch(t);return await i.text()}async start(){const t=(0,a.preprocess)("shaders","vs.glsl"),i=await(0,a.preprocess)("shaders","fs.glsl");console.log(i);const e=this.createProgram(await t,i);this.gl.useProgram(e),this.createBuffer();const s=this.gl.getAttribLocation(e,"aVertexPosition");this.gl.enableVertexAttribArray(s),this.gl.vertexAttribPointer(s,2,this.gl.FLOAT,!1,0,0),this.resolutionUniform=this.gl.getUniformLocation(e,"uResolution"),this.timeUniform=this.gl.getUniformLocation(e,"uTime"),this.onProgramInit(e),this.startTime=this.currentTime=performance.now()/1e3,this.loop()}createBuffer(){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.gl.createBuffer()),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array([1,1,-1,1,1,-1,-1,-1]),this.gl.STATIC_DRAW)}resizeCanvasToDisplaySize(){if(void 0===this.canvas)return;const t=window.innerWidth,i=window.innerHeight;this.canvas.width===t&&this.canvas.height===i||(this.canvas.width=t,this.canvas.height=i,this.gl.viewport(0,0,this.canvas.width,this.canvas.height))}setTexture(t,i,e,s){const a=this.gl.createTexture();this.gl.bindTexture(this.gl.TEXTURE_2D,a),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.REPEAT),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.REPEAT),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,e);const n=this.gl.getUniformLocation(t,i);return this.gl.uniform1i(n,s),a}setTextureWithMIP(t,i,e,s){const a=this.gl.createTexture();this.gl.bindTexture(this.gl.TEXTURE_2D,a),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.REPEAT),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.REPEAT),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR_MIPMAP_LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,e),this.gl.generateMipmap(this.gl.TEXTURE_2D);const n=this.gl.getUniformLocation(t,i);return this.gl.uniform1i(n,s),a}loop(){this.resizeCanvasToDisplaySize();const t=performance.now()/1e3,i=t-this.startTime,e=t-this.currentTime;this.currentTime=t,this.gl.uniform2f(this.resolutionUniform,this.canvas.width,this.canvas.height),this.gl.uniform2f(this.timeUniform,i,e),this.onProgramLoop(i,e),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4),requestAnimationFrame(this.loop.bind(this))}}i.Engine=n},490:(t,i,e)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.Flare=void 0;const s=e(193),a=e(421),n=e(921);i.Flare=class{constructor(t,i=new s.Vec3(100,100,100)){this.velocity=s.Vec3.ZERO(),this.initialSpeed=100,this.initialDirection=new s.Vec3(0,Math.sin((0,n.rad)(15)),-Math.cos((0,n.rad)(15))),this.isVisible=!1,this.g=9.81,this.n=0,this.camera=t,this.position=this.camera.position.copy(),this.light=i}update(t,i){if(this.isVisible){this.position.addMutable(this.velocity.mul(i)),this.velocity.addMutable(new s.Vec3(0,-this.g*i,0));const t=this.camera.tSampler.terrainM(new s.Vec2(this.position.x,this.position.z)),e=this.position.y-t;if(e<0){if(++this.n>0)return void(this.isVisible=!1);this.position.y-=e;const t=this.camera.tSampler.calcNormalM(this.position,200);this.velocity.addMutable(t.mul(-1.1*t.dot(this.velocity))).mulMutable(.6)}}else(0,a.isKeyPress)(70)>0&&(this.isVisible=!0,this.n=0,this.position=this.camera.position.add(this.camera.orientation.rotate(s.Vec3.I())),this.velocity=this.camera.velocity.add(this.camera.orientation.rotate(this.initialDirection).mul(this.initialSpeed)))}}},318:(t,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.GLContext=void 0,i.GLContext=class{constructor(t){if(void 0!==t){if(this.canvas=document.getElementById(t),void 0===this.canvas)throw new Error("Cannot find element named: "+t)}else this.canvas=document.createElement("canvas"),document.body.appendChild(this.canvas);if(this.gl=this.canvas.getContext("webgl2"),!this.gl)throw new Error("Unable to initialize WebGL. Your browser or machine may not support it.")}createShader(t,i){const e=this.gl.createShader(t);return this.gl.shaderSource(e,i.trim()),this.gl.compileShader(e),this.gl.getShaderParameter(e,this.gl.COMPILE_STATUS)?e:(alert("Error compiling shader: "+this.gl.getShaderInfoLog(e)),this.gl.deleteShader(e),null)}createProgram(t,i){const e=this.createShader(this.gl.VERTEX_SHADER,t),s=this.createShader(this.gl.FRAGMENT_SHADER,i),a=this.gl.createProgram();return this.gl.attachShader(a,e),this.gl.attachShader(a,s),this.gl.linkProgram(a),this.gl.getProgramParameter(a,this.gl.LINK_STATUS)?a:(alert("Unable to initialize the shader program: "+this.gl.getProgramInfoLog(a)),null)}}},421:(t,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.isKeyDown=i.isKeyPress=i.initKeyBuffer=void 0;const e=256,s=Array(e).fill(0);function a(t){t.keyCode>=e||(s[t.keyCode]=1,t.preventDefault())}function n(t){t.keyCode>=e||(s[t.keyCode]=0,t.preventDefault())}i.initKeyBuffer=function(){window.addEventListener("keydown",a,!1),window.addEventListener("keyup",n,!1)},i.isKeyPress=function(t){const i=s[t];return s[t]=0,i},i.isKeyDown=function(t){return s[t]}},921:(t,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.rad=i.smoothstep=void 0,i.smoothstep=function(t,i,e){if(e<t)return 0;if(e>=i)return 1;const s=(e-t)/(i-t);return s*s*(3-2*s)},i.rad=function(t){return Math.PI*t/180}},100:(t,i,e)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.NoiseSampler=void 0;const s=e(193);i.NoiseSampler=class{constructor(t){const i=document.createElement("canvas");i.width=t.width,i.height=t.height;const e=i.getContext("2d");e.drawImage(t,0,0,t.width,t.height),this._data=e.getImageData(0,0,i.width,i.height)}getSample(t){const i=t.fract(),e=Math.floor(i.x*this._data.width),s=Math.floor(i.y*this._data.height);return this._data.data[s*this._data.width+e<<2]/255}noiseD(t){const i=t.floor(),e=t.copy().subMutable(i),a=new s.Vec2(3,3).subMutable(e.mul(2)).mulElMutable(e).mulElMutable(e),n=new s.Vec2(1,1).subMutable(e).mulElMutable(e).mulMutable(6),o=this.getSample(new s.Vec2(.5,.5).addMutable(i).divMutable(256)),r=this.getSample(new s.Vec2(1.5,.5).addMutable(i).divMutable(256)),h=this.getSample(new s.Vec2(.5,1.5).addMutable(i).divMutable(256)),l=this.getSample(new s.Vec2(1.5,1.5).addMutable(i).divMutable(256));return{value:o+(r-o)*a.x+(h-o)*a.y+(o-r-h+l)*a.x*a.y,derivative:new s.Vec2(n.x*(a.y*(o-r-h+l)+r-o),n.y*(a.x*(o-r-h+l)+h-o))}}}},704:(t,i,e)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.Quaternion=void 0;const s=e(193);class a extends s.Vec4{invert(){return new a(-this.x,-this.y,-this.z,this.w).divMutable(this.dot(this))}qmul(t){return new a(this.w*t.x+this.x*t.w+this.y*t.z-this.z*t.y,this.w*t.y+this.y*t.w+this.z*t.x-this.x*t.z,this.w*t.z+this.z*t.w+this.x*t.y-this.y*t.x,this.w*t.w-this.x*t.x-this.y*t.y-this.z*t.z)}rotate(t){const i=new a(t.x,t.y,t.z,0),e=this.qmul(i).qmul(this.invert());return new s.Vec3(e.x,e.y,e.z)}mat3(){return new s.Mat3(this.rotate(s.Vec3.I()),this.rotate(s.Vec3.J()),this.rotate(s.Vec3.K()))}static byAngle(t,i){const e=.5*i,s=t.mul(Math.sin(e));return new a(s.x,s.y,s.z,Math.cos(e))}static byYawPitchRoll(t,i,e){return a.byAngle(s.Vec3.I(),i).qmul(a.byAngle(s.Vec3.J(),t).qmul(a.byAngle(s.Vec3.K(),e)))}}i.Quaternion=a,a.Identity=()=>new a(0,0,0,1)},240:(t,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.preprocess=void 0,i.preprocess=async function t(i,e,s=0){if(s>10)throw new Error("Превышено возможное количество уровней вложения модулей программы");const a=(await async function(t){let i=await fetch(t);return await i.text()}(i+"/"+e)).split("\n").map((async e=>{if(e.startsWith("#include")){const[a,n]=e.split(/\s/,2);return await t(i,n.replace(/["']/g,""),s+1)}return e}));return(await Promise.all(a)).join("\n")}},385:(t,i,e)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.Sky=void 0;const s=e(704),a=e(193),n=e(421),o=.12*Math.PI;i.Sky=class{constructor(){this.quat=s.Quaternion.byAngle(a.Vec3.I(),.5*Math.PI),this.axis=new a.Vec3(0,Math.cos(o),-Math.sin(o)),this.period=1200,this.sunDir=new a.Vec3(0,-Math.sin(o),-Math.cos(o)),this.orientation=s.Quaternion.Identity(),this.transformMat=a.Mat3.ID(),this.isShowConstellations=!1,this.sunDirection=this.sunDir.copy()}loopCalculation(t,i){this.orientation=s.Quaternion.byAngle(this.axis,-2*Math.PI*(.205+t/this.period)),this.transformMat=this.orientation.qmul(this.quat).mat3(),this.sunDirection=this.orientation.rotate(this.sunDir).normalize(),(0,n.isKeyPress)(67)>0&&(this.isShowConstellations=!this.isShowConstellations)}}},270:(t,i,e)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.TerrainSampler=void 0;const s=e(24),a=e(921),n=e(193),o=new n.Mat2(new n.Vec2(.8,-.6),new n.Vec2(.6,.8)),r=3e3,h=1100;i.TerrainSampler=class{constructor(t){this._noiseSampler=t}terrainH(t){let i=t.div(r),e=0,s=1;const a=n.Vec2.ZERO();for(let t=0;t<16;t++){const t=this._noiseSampler.noiseD(i);a.addMutable(t.derivative),e+=s*t.value/(1+a.dot(a)),s*=.5,i=o.mul(i.add(i))}return h*e}terrainM(t){let i=t.div(r),e=0,s=1;const a=n.Vec2.ZERO();for(let t=0;t<9;t++){const t=this._noiseSampler.noiseD(i);a.addMutable(t.derivative),e+=s*t.value/(1+a.dot(a)),s*=.5,i=o.mul(i.add(i))}return h*e}terrainS(t){let i=t.div(r),e=0,s=1;const a=n.Vec2.ZERO();for(let t=0;t<5;t++){const t=this._noiseSampler.noiseD(i);a.addMutable(t.derivative),e+=s*t.value/(1+a.dot(a)),s*=.5,i=o.mul(i.add(i))}return h*e}calcNormalM(t,i){const e=new n.Vec2(.001*i,0);return new n.Vec3(this.terrainM(new n.Vec2(t.x-e.x,t.z-e.y))-this.terrainM(new n.Vec2(t.x+e.x,t.z+e.y)),2*e.x,this.terrainM(new n.Vec2(t.x-e.y,t.z-e.x))-this.terrainM(new n.Vec2(t.x+e.y,t.z+e.x))).normalize()}softShadow(t,i){let e=1,o=.1;const r=Math.sqrt(1-i.z*i.z);for(let h=0;h<200;h++){const h=t.add(i.mul(o));if(h.y>1980)return(0,a.smoothstep)(-s.SUN_DISC_ANGLE_SIN,s.SUN_DISC_ANGLE_SIN,e);const l=h.y-this.terrainM(new n.Vec2(h.x,h.z));if(e=Math.min(e,r*l/o),e<-s.SUN_DISC_ANGLE_SIN)return(0,a.smoothstep)(-s.SUN_DISC_ANGLE_SIN,s.SUN_DISC_ANGLE_SIN,e);o+=Math.max(1,.6*Math.abs(l))}return 0}}},193:(t,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.Mat2=i.Vec2=i.Mat3=i.Vec3=i.Mat4=i.Vec4=void 0;class e{constructor(t,i,e,s){this.x=t,this.y=i,this.z=e,this.w=s}addMutable(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}subMutable(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}mulMutable(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}divMutable(t){return this.x/=t,this.y/=t,this.z/=t,this.w/=t,this}mulElMutable(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}divElMutable(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this.w/=t.w,this}normalizeMutable(){return this.divMutable(Math.sqrt(this.dot(this)))}add(t){return this.copy().addMutable(t)}sub(t){return this.copy().subMutable(t)}mul(t){return this.copy().mulMutable(t)}div(t){return this.copy().divMutable(t)}mulEl(t){return this.copy().mulElMutable(t)}divEl(t){return this.copy().divElMutable(t)}normalize(){return this.copy().normalizeMutable()}length(){return Math.sqrt(this.dot(this))}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}copy(){return new e(this.x,this.y,this.z,this.w)}floor(){return new e(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z),Math.floor(this.w))}fract(){return this.copy().subMutable(this.floor())}}i.Vec4=e,e.ZERO=()=>new e(0,0,0,0),e.ONE=()=>new e(1,1,1,1),e.I=()=>new e(1,0,0,0),e.J=()=>new e(0,1,0,0),e.K=()=>new e(0,0,1,0),e.L=()=>new e(0,0,0,1);class s{constructor(t,i,e,s){this.i=t.copy(),this.j=i.copy(),this.k=e.copy(),this.l=s.copy()}mulLeft(t){return new e(this.i.dot(t),this.j.dot(t),this.k.dot(t),this.j.dot(t))}mul(t){return new e(t.x*this.i.x+t.y*this.j.x+t.z*this.k.x+t.w*this.j.x,t.x*this.i.y+t.y*this.j.y+t.z*this.k.y+t.w*this.j.y,t.x*this.i.z+t.y*this.j.z+t.z*this.k.z+t.w*this.j.z,t.x*this.i.w+t.y*this.j.w+t.z*this.k.w+t.w*this.j.w)}}i.Mat4=s,s.ID=()=>new s(e.I(),e.J(),e.K(),e.L()),s.ZERO=()=>new s(e.ZERO(),e.ZERO(),e.ZERO(),e.ZERO());class a{constructor(t,i,e){this.x=t,this.y=i,this.z=e}addMutable(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}subMutable(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}mulMutable(t){return this.x*=t,this.y*=t,this.z*=t,this}divMutable(t){return this.x/=t,this.y/=t,this.z/=t,this}mulElMutable(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}divElMutable(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}normalizeMutable(){return this.divMutable(Math.sqrt(this.dot(this)))}safeNormalize(){const t=Math.sqrt(this.dot(this));return t<Number.MIN_VALUE?a.ZERO():this.div(t)}colorNormalize(){const t=Math.max(this.x,this.y,this.z);return t<Number.MIN_VALUE?a.ZERO():this.div(t)}add(t){return this.copy().addMutable(t)}sub(t){return this.copy().subMutable(t)}mul(t){return this.copy().mulMutable(t)}div(t){return this.copy().divMutable(t)}mulEl(t){return this.copy().mulElMutable(t)}divEl(t){return this.copy().divElMutable(t)}normalize(){return this.copy().normalizeMutable()}length(){return Math.sqrt(this.dot(this))}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}copy(){return new a(this.x,this.y,this.z)}floor(){return new a(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z))}fract(){return this.copy().subMutable(this.floor())}exp(){return new a(Math.exp(this.x),Math.exp(this.y),Math.exp(this.z))}cross(t){return new a(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)}}i.Vec3=a,a.ZERO=()=>new a(0,0,0),a.ONE=()=>new a(1,1,1),a.I=()=>new a(1,0,0),a.J=()=>new a(0,1,0),a.K=()=>new a(0,0,1);class n{constructor(t,i,e){this.i=t.copy(),this.j=i.copy(),this.k=e.copy()}mulLeft(t){return new a(this.i.dot(t),this.j.dot(t),this.k.dot(t))}mul(t){return new a(t.x*this.i.x+t.y*this.j.x+t.z*this.k.x,t.x*this.i.y+t.y*this.j.y+t.z*this.k.y,t.x*this.i.z+t.y*this.j.z+t.z*this.k.z)}}i.Mat3=n,n.ID=()=>new n(a.I(),a.J(),a.K()),n.ZERO=()=>new n(a.ZERO(),a.ZERO(),a.ZERO());class o{constructor(t,i){this.x=t,this.y=i}addMutable(t){return this.x+=t.x,this.y+=t.y,this}subMutable(t){return this.x-=t.x,this.y-=t.y,this}mulMutable(t){return this.x*=t,this.y*=t,this}divMutable(t){return this.x/=t,this.y/=t,this}mulElMutable(t){return this.x*=t.x,this.y*=t.y,this}divElMutable(t){return this.x/=t.x,this.y/=t.y,this}normalizeMutable(){return this.divMutable(Math.sqrt(this.dot(this)))}add(t){return this.copy().addMutable(t)}sub(t){return this.copy().subMutable(t)}mul(t){return this.copy().mulMutable(t)}div(t){return this.copy().divMutable(t)}mulEl(t){return this.copy().mulElMutable(t)}divEl(t){return this.copy().divElMutable(t)}normalize(){return this.copy().normalizeMutable()}length(){return Math.sqrt(this.dot(this))}dot(t){return this.x*t.x+this.y*t.y}copy(){return new o(this.x,this.y)}floor(){return new o(Math.floor(this.x),Math.floor(this.y))}fract(){return this.copy().subMutable(this.floor())}cross(t){return this.x*t.y-this.y*t.x}}i.Vec2=o,o.ZERO=()=>new o(0,0),o.ONE=()=>new o(1,1),o.I=()=>new o(1,0),o.J=()=>new o(0,1);class r{constructor(t,i){this.i=t.copy(),this.j=i.copy()}mulLeft(t){return new o(this.i.dot(t),this.j.dot(t))}mul(t){return new o(t.x*this.i.x+t.y*this.j.x,t.x*this.i.y+t.y*this.j.y)}}i.Mat2=r,r.ID=()=>new r(o.I(),o.J()),r.ZERO=()=>new r(o.ZERO(),o.ZERO())},460:(t,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.loadImage=void 0,i.loadImage=function(t){return new Promise(((i,e)=>{const s=new Image;s.onload=()=>i(s),s.onerror=()=>e(),s.src=t}))}}},i={};(0,function e(s){var a=i[s];if(void 0!==a)return a.exports;var n=i[s]={exports:{}};return t[s](n,n.exports,e),n.exports}(752).Z)()})();