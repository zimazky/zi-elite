(()=>{"use strict";var t={752:(t,i,e)=>{const s=e(331),r=e(764),a=e(115),n=e(490),h=e(421),o=e(100),l=e(704),u=e(385),g=e(270),c=e(193),m=e(237),d=e(386),f=e(460);i.Z=async function(){const t=document.getElementById("info"),i=new a.Engine("glcanvas");let e=0,p=0;(0,h.initKeyBuffer)();const y=await(0,f.loadImage)("textures/gray_noise.png"),M=await(0,f.loadImage)("textures/blue_noise.png"),b=await(0,f.loadImage)("textures/starmap_2020_16k_gal.jpg"),E=await(0,f.loadImage)("textures/constellation_figures_8k_gal.jpg"),w=new g.TerrainSampler(new o.NoiseSampler(y)),x=localStorage.getItem("ziEliteData")??"{}";console.log("localStorage",x),JSON.parse(x);let R=new c.Vec3(2316,0,7696),T=new l.Quaternion(0,-.9908125427905498,0,.13524239368232574);const L=new r.Camera(R,T,w),v=new s.Atmosphere,_=new u.Sky,A=new n.Flare(L),S=new n.Flare(L),P=await i.addFramebuffer(1536,762,"shaders/a","vs.glsl","fs.glsl",(t=>{I.init(t)}),((t,i)=>{I.update()})),D=await i.addFramebuffer(1536,762,"shaders/b","vs.glsl","fs.glsl",(t=>{U.init(t,y,b,E)}),((t,i)=>{U.update(t,i)})),I=new m.ProgramA(i,D,L),U=new d.ProgramB(i,P,L,v,_,A,S);i.onUpdate=(s,r)=>{if(L.loopCalculation(s,r),_.loopCalculation(s,r),A.update(s,r),S.update(s,r),s>e){const a=1e3*r,n=L.velocity.length(),h=3.6*n,o=i.canvas.width.toFixed(0),l=i.canvas.height.toFixed(0);t.innerText=`dt: ${a.toFixed(2)} fps: ${(1e3/a).toFixed(2)} ${o}x${l}\n      v: ${n.toFixed(2)}m/s (${h.toFixed(2)}km/h)\n      alt: ${L.altitude.toFixed(2)} h: ${L.position.y.toFixed(2)}`,e=s+.5}if(s>p){const t=JSON.stringify({position:L.position,orientation:L.orientation});localStorage.setItem("ziEliteData",t),p=s+5}},await i.setRenderbuffer("shaders/render","vs.glsl","fs.glsl",(t=>{i.setRenderedTexture(t.program,P.fbTexture,"uTextureProgramA"),i.setRenderedTexture(t.program,D.fbTexture,"uTextureProgramB");const e=P.width,s=P.height,r=i.gl.getUniformLocation(t.program,"uTextureBResolution");i.gl.uniform2f(r,e,s),i.setTexture(t.program,"uTextureBlueNoise",M)})),i.start()}},331:(t,i,e)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.Atmosphere=void 0;const s=e(24),r=e(921),a=e(193),n=Math.PI*Math.PI*Math.PI,h=1.04345246,o=1/(4*Math.PI);i.Atmosphere=class{constructor(){this.planetRadius=6371e3,this.planetCenter=new a.Vec3(0,-this.planetRadius,0),this.radius=6471e3,this.n=1.00029,this.rgbLambda=new a.Vec3(615e-9,535e-9,445e-9),this.betaRayleigh=new a.Vec3(55e-7,13e-6,224e-7),this.betaMie=a.Vec3.ONE().mulMutable(2e-7),this.g=.996,this.p=.035,this.heightRayleigh=8e3,this.heightMie=1200,this.planetRadius2=this.planetRadius*this.planetRadius,this.radius2=this.radius*this.radius}computeBetaRayleigh(t){const i=this.n*this.n-1,e=t*t;return 8*n*i*i*(6+3*this.p)/(7512000000000001e10*e*e*(6-7*this.p))}ChHOld(t,i,e){const s=t+i,r=h*Math.sqrt(s),a=r*Math.exp(-i);if(e>=0)return a/(r*e+1);{const i=Math.sqrt(1-e*e)*s;return h*Math.sqrt(i)*2*Math.exp(t-i)-a/(1-r*e)}}ChH(t,i,e){const s=t+i,r=h*Math.sqrt(s),a=r*Math.exp(-i);if(e>=0)return a/((r-1)*e+1);{const i=Math.sqrt(1-e*e);return a/((r-1)*e-1)+2*r*Math.exp(t-s*i)*Math.sqrt(i)}}softPlanetShadow(t,i){const e=t.sub(this.planetCenter),a=e.dot(i),n=Math.sqrt(e.dot(e)-a*a);if(a>0)return 1;const h=(this.planetRadius-n)/a;return(0,r.smoothstep)(-s.SUN_DISC_ANGLE_SIN,s.SUN_DISC_ANGLE_SIN,h)}scattering(t,i,e){const s=t.sub(this.planetCenter);let r=s.dot(s),n=-s.dot(i);const h=r-n*n;if(h>=this.radius2)return{t:a.Vec3.ZERO(),i:a.Vec3.ONE()};const l=Math.sqrt(this.radius2-h);let u=2*l;if(r>this.radius2){if(n<0)return{t:a.Vec3.ZERO(),i:a.Vec3.ONE()};s.addMutable(i.mul(n-l)),r=this.radius2,n=l}else u=l-s.dot(i);let g=!1;s.normalize().dot(i)<0&&h<this.planetRadius2&&(u=n-Math.sqrt(this.planetRadius2-h),g=!0);const c=i.dot(e),m=c*c,d=this.g*this.g,f=.75*(1+m)*o,p=1.5*(1-d)/(2+d)*(1+m)/Math.pow(1+d-2*c*this.g,1.5)*o,y=u/32,M=i.mul(y),b=s.add(M),E=s.add(M.mul(.5));let w=0,x=0;const R=a.Vec3.ZERO(),T=a.Vec3.ZERO();let L=y*Math.exp(-(s.length()-this.planetRadius)/this.heightRayleigh),v=y*Math.exp(-(s.length()-this.planetRadius)/this.heightMie);for(let t=0;t<32;t++,b.addMutable(M),E.addMutable(M)){const t=b.length()-this.planetRadius,i=y*Math.exp(-t/this.heightRayleigh),s=y*Math.exp(-t/this.heightMie);w+=.5*(i+L),x+=.5*(s+v),L=i,v=s;const r=E.dot(e),a=E.dot(E)-r*r;if(r>0||a>this.planetRadius2){const t=E.normalize().dot(e),r=E.length()-this.planetRadius,a=this.heightRayleigh*this.ChH(this.planetRadius/this.heightRayleigh,r/this.heightRayleigh,t),n=this.heightMie*this.ChH(this.planetRadius/this.heightMie,r/this.heightMie,t),h=this.betaRayleigh.mul(-w-a).addMutable(this.betaMie.mul(-x-n)).exp();R.addMutable(h.mul(i)),T.addMutable(h.mul(s))}}const _=g?this.betaRayleigh.mul(-w).exp():this.betaRayleigh.mul(-w).addMutable(this.betaMie.mul(-x)).exp();return{t:this.betaRayleigh.mulEl(R).mulMutable(f).addMutable(this.betaMie.mulEl(T).mulMutable(p)),i:_}}transmittance(t,i){const e=t.sub(this.planetCenter);let s=e.dot(e),r=-e.dot(i);const n=s-r*r;if(n>=this.radius2)return a.Vec3.ZERO();const h=Math.sqrt(this.radius2-n);let l=2*h;if(s>this.radius2){if(r<0)return a.Vec3.ZERO();e.addMutable(i.mul(r-h)),s=this.radius2,r=h}else l=h-e.dot(i);let u=!1;e.normalize().dot(i)<0&&n<this.planetRadius2&&(l=r-Math.sqrt(this.planetRadius2-n));const g=this.g*this.g,c=1.5*o,m=1.5*(1-g)/(2+g)*2/Math.pow(1+g-2*this.g,1.5)*o,d=l/32,f=i.mul(d),p=e.add(f),y=e.add(f.mul(.5));let M=0,b=0;const E=a.Vec3.ZERO(),w=a.Vec3.ZERO();let x=d*Math.exp(-(e.length()-this.planetRadius)/this.heightRayleigh),R=d*Math.exp(-(e.length()-this.planetRadius)/this.heightMie);for(let t=0;t<32;t++,p.addMutable(f),y.addMutable(f)){const t=p.length()-this.planetRadius,i=d*Math.exp(-t/this.heightRayleigh),e=d*Math.exp(-t/this.heightMie);M+=.5*(i+x),b+=.5*(e+R),x=i,R=e;const s=this.betaRayleigh.mul(-M).addMutable(this.betaMie.mul(-b)).exp();E.addMutable(s.mul(i)),w.addMutable(s.mul(e))}return this.betaRayleigh.mulEl(E).mulMutable(c).addMutable(this.betaMie.mulEl(w).mulMutable(m))}}},764:(t,i,e)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.Camera=void 0;const s=e(421),r=e(704),a=e(193),n=new a.Vec3(.01,.05,.001).mulMutable(58),h=Math.PI/180;i.Camera=class{constructor(t,i,e){this.direction=new a.Vec3(0,0,-1),this.transformMat=a.Mat3.ID(),this.transformMatPrev=a.Mat3.ID(),this.positionDelta=a.Vec3.ZERO(),this.headLights=0,this.position=t.copy(),this.velocity=a.Vec3.ZERO(),this.angularSpeed=a.Vec3.ZERO(),this.orientation=i,this.viewAngle=80*Math.PI/180,this.tSampler=e,this.screenMode=0,this.mapMode=0,this.mapScale=1}inShadow(t,i,e){const s=t.softPlanetShadow(i,e);if(s<=.001)return 0;const r=s*this.tSampler.softShadow(this.position,e);return Math.pow(r,4)}loopCalculation(t,i){const e=new a.Vec3(0,0,(0,s.isKeyDown)(83)-(0,s.isKeyDown)(87));this.transformMatPrev=this.transformMat;const o=this.orientation.mat3();this.transformMat=o,this.velocity.addMutable(o.mul(e).mulMutable(11*i)),this.velocity.subMutable(o.mul(o.mulLeft(this.velocity).mulElMutable(n)).mulMutable(i)),this.velocity.y-=0*i,(0,s.isKeyDown)(32)>0&&(this.velocity=a.Vec3.ZERO()),this.positionDelta=this.position.copy(),this.position.addMutable(this.velocity.mul(i));const l=this.tSampler.terrainM(new a.Vec2(this.position.x,this.position.z))+2;this.position.y<l&&(this.velocity.y=0,this.position.y=l),this.positionDelta=this.position.sub(this.positionDelta),this.altitude=this.position.y-l;const u=new a.Vec3((0,s.isKeyDown)(40)-(0,s.isKeyDown)(38),(0,s.isKeyDown)(188)-(0,s.isKeyDown)(190),2*((0,s.isKeyDown)(37)-(0,s.isKeyDown)(39)));this.angularSpeed.addMutable(u.mulMutable(3*h*i)),this.angularSpeed.subMutable(this.angularSpeed.mul(3*i));const g=this.angularSpeed.mul(.5);this.orientation=this.orientation.qmul(new r.Quaternion(0,0,Math.sin(g.z),Math.cos(g.z))),this.orientation=this.orientation.qmul(new r.Quaternion(Math.sin(g.x),0,0,Math.cos(g.x))),this.orientation=this.orientation.qmul(new r.Quaternion(0,Math.sin(g.y),0,Math.cos(g.y))),this.orientation.normalizeMutable(),this.direction=this.orientation.rotate(new a.Vec3(0,0,-1)),(0,s.isKeyPress)(77)>0&&(this.screenMode=0==this.screenMode?1:0),1==this.screenMode?(this.mapScale*=1+.01*((0,s.isKeyDown)(109)+(0,s.isKeyDown)(189)-(0,s.isKeyDown)(107)-(0,s.isKeyDown)(187)),(0,s.isKeyPress)(71)>0&&(this.mapMode^=1),(0,s.isKeyPress)(72)>0&&(this.mapMode^=2)):this.viewAngle+=.01*((0,s.isKeyDown)(109)-(0,s.isKeyDown)(107)),(0,s.isKeyPress)(76)>0&&(this.headLights=0==this.headLights?100:0)}}},24:(t,i,e)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.SUN_COLOR=i.SUN_DISC_ANGLE_SIN=void 0;const s=e(193);i.SUN_DISC_ANGLE_SIN=.008725,i.SUN_COLOR=s.Vec3.ONE()},115:(t,i,e)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.Engine=void 0;const s=e(318),r=e(240);class a extends s.GLContext{constructor(t){super(t),this.textureCount=0,this.framebuffers=[],this.onUpdate=(t,i)=>{}}async addFramebuffer(t,i,e,s,a,n=(t=>{}),h=((t,i)=>{})){const o=(0,r.preprocess)(e,s),l=(0,r.preprocess)(e,a),u=this.createProgram(await o,await l),[g,c]=this.createFramebuffer(t,i);this.gl.useProgram(u);const m=this.gl.getUniformLocation(u,"uResolution"),d=this.gl.getUniformLocation(u,"uTime");return this.framebuffers.push({width:t,height:i,program:u,framebuffer:g,fbTexture:c,vertexArray:null,numOfVertices:4,isElementDraw:!1,isDepthTest:!1,clearColor:null,resolutionLocation:m,timeLocation:d,onProgramInit:n,onProgramLoop:h}),this.framebuffers[this.framebuffers.length-1]}async setRenderbuffer(t,i,e,s=(t=>{}),a=((t,i)=>{})){const n=(0,r.preprocess)(t,i),h=(0,r.preprocess)(t,e),o=this.createProgram(await n,await h);this.gl.useProgram(o);const l=this.gl.getUniformLocation(o,"uResolution"),u=this.gl.getUniformLocation(o,"uTime");this.renderbufer={program:o,vertexArray:null,numOfVertices:4,isElementDraw:!1,isDepthTest:!1,clearColor:null,resolutionLocation:l,timeLocation:u,onProgramInit:s,onProgramLoop:a}}async loadShader(t){let i=await fetch(t);return await i.text()}setVertexArray(t,i,e,s,r=2){t.vertexArray=this.gl.createVertexArray(),t.numOfVertices=e.length/r,this.gl.bindVertexArray(t.vertexArray);const a=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,a),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(e),this.gl.STATIC_DRAW);const n=this.gl.getAttribLocation(t.program,i);if(this.gl.enableVertexAttribArray(n),this.gl.vertexAttribPointer(n,r,this.gl.FLOAT,!1,0,0),null===s)return;t.isElementDraw=!0,t.numOfVertices=s.length;const h=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,h),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,new Uint32Array(s),this.gl.STATIC_DRAW)}setRenderedTexture(t,i,e){const s=this.gl.getUniformLocation(t,e);this.gl.useProgram(t);const r=this.textureCount;this.gl.uniform1i(s,r),this.gl.activeTexture(this.gl.TEXTURE0+r),this.gl.bindTexture(this.gl.TEXTURE_2D,i),this.textureCount++}resizeCanvasToDisplaySize(){if(void 0===this.canvas)return;const t=window.innerWidth,i=window.innerHeight;this.canvas.width===t&&this.canvas.height===i||(this.canvas.width=t,this.canvas.height=i,this.gl.viewport(0,0,this.canvas.width,this.canvas.height))}setTexture(t,i,e){const s=this.gl.createTexture(),r=this.textureCount;this.gl.activeTexture(this.gl.TEXTURE0+r),this.gl.bindTexture(this.gl.TEXTURE_2D,s),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.REPEAT),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.REPEAT),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,e);const a=this.gl.getUniformLocation(t,i);return this.gl.uniform1i(a,r),this.textureCount++,s}setTextureWithMIP(t,i,e){const s=this.gl.createTexture(),r=this.textureCount;this.gl.activeTexture(this.gl.TEXTURE0+r),this.gl.bindTexture(this.gl.TEXTURE_2D,s),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.REPEAT),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.REPEAT),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR_MIPMAP_LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,e),this.gl.generateMipmap(this.gl.TEXTURE_2D);const a=this.gl.getUniformLocation(t,i);return this.gl.uniform1i(a,r),this.textureCount++,s}start(){this.resizeCanvasToDisplaySize(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.gl.createBuffer()),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array([1,1,-1,1,1,-1,-1,-1]),this.gl.STATIC_DRAW),this.gl.enableVertexAttribArray(0),this.gl.vertexAttribPointer(0,2,this.gl.FLOAT,!1,0,0),this.framebuffers.forEach((t=>{this.gl.useProgram(t.program),t.onProgramInit(t)})),this.gl.useProgram(this.renderbufer.program),this.renderbufer.onProgramInit(this.renderbufer),this.startTime=this.currentTime=performance.now()/1e3,this.loop()}loop(){const t=performance.now()/1e3,i=t-this.startTime,e=t-this.currentTime;this.currentTime=t,this.onUpdate(i,e),this.framebuffers.forEach((t=>{this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,t.framebuffer),this.gl.useProgram(t.program),null!==t.clearColor&&(this.gl.clearColor(t.clearColor.x,t.clearColor.y,t.clearColor.z,t.clearColor.w),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),t.isDepthTest?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST)),this.gl.bindVertexArray(t.vertexArray),this.gl.uniform2f(t.resolutionLocation,t.width,t.height),this.gl.uniform2f(t.timeLocation,i,e),this.gl.viewport(0,0,t.width,t.height),t.isElementDraw?this.gl.drawElements(this.gl.TRIANGLE_STRIP,t.numOfVertices,this.gl.UNSIGNED_INT,0):this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,t.numOfVertices),t.onProgramLoop(i,e)})),this.resizeCanvasToDisplaySize(),this.gl.disable(this.gl.DEPTH_TEST),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),this.gl.useProgram(this.renderbufer.program),this.gl.bindVertexArray(this.renderbufer.vertexArray),this.gl.uniform2f(this.renderbufer.resolutionLocation,this.canvas.width,this.canvas.height),this.gl.uniform2f(this.renderbufer.timeLocation,i,e),this.gl.viewport(0,0,this.canvas.width,this.canvas.height),this.renderbufer.isElementDraw?this.gl.drawElements(this.gl.TRIANGLE_STRIP,this.renderbufer.numOfVertices,this.gl.UNSIGNED_INT,0):this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,this.renderbufer.numOfVertices),this.renderbufer.onProgramLoop(i,e),requestAnimationFrame(this.loop.bind(this))}}i.Engine=a},490:(t,i,e)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.Flare=void 0;const s=e(193),r=e(421),a=e(921);i.Flare=class{constructor(t,i=new s.Vec3(100,100,100)){this.velocity=s.Vec3.ZERO(),this.initialSpeed=100,this.initialDirection=new s.Vec3(0,Math.sin((0,a.rad)(15)),-Math.cos((0,a.rad)(15))),this.isVisible=!1,this.g=9.81,this.n=0,this.camera=t,this.position=this.camera.position.copy(),this.light=i}update(t,i){if(this.isVisible){this.position.addMutable(this.velocity.mul(i)),this.velocity.addMutable(new s.Vec3(0,-this.g*i,0));const t=this.camera.tSampler.terrainM(new s.Vec2(this.position.x,this.position.z)),e=this.position.y-t;if(e<0){if(++this.n>0)return void(this.isVisible=!1);this.position.y-=e;const t=this.camera.tSampler.calcNormalM(this.position,200);this.velocity.addMutable(t.mul(-1.1*t.dot(this.velocity))).mulMutable(.6)}}else(0,r.isKeyPress)(70)>0&&(this.isVisible=!0,this.n=0,this.position=this.camera.position.add(this.camera.orientation.rotate(s.Vec3.I())),this.velocity=this.camera.velocity.add(this.camera.orientation.rotate(this.initialDirection).mul(this.initialSpeed)))}}},318:(t,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.GLContext=void 0,i.GLContext=class{constructor(t){if(void 0!==t){if(this.canvas=document.getElementById(t),void 0===this.canvas)throw new Error("Cannot find element named: "+t)}else this.canvas=document.createElement("canvas"),document.body.appendChild(this.canvas);if(this.gl=this.canvas.getContext("webgl2"),!this.gl)throw new Error("Unable to initialize WebGL. Your browser or machine may not support it.");this.gl.getExtension("EXT_color_buffer_float")}createShader(t,i){const e=this.gl.createShader(t);return this.gl.shaderSource(e,i.trim()),this.gl.compileShader(e),this.gl.getShaderParameter(e,this.gl.COMPILE_STATUS)?e:(alert("Error compiling shader: "+this.gl.getShaderInfoLog(e)),this.gl.deleteShader(e),null)}createProgram(t,i){const e=this.createShader(this.gl.VERTEX_SHADER,t),s=this.createShader(this.gl.FRAGMENT_SHADER,i),r=this.gl.createProgram();return this.gl.attachShader(r,e),this.gl.attachShader(r,s),this.gl.linkProgram(r),this.gl.getProgramParameter(r,this.gl.LINK_STATUS)?r:(alert("Unable to initialize the shader program: "+this.gl.getProgramInfoLog(r)),null)}createFramebuffer(t,i){const e=this.gl.createTexture();this.gl.bindTexture(this.gl.TEXTURE_2D,e),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA16F,t,i,0,this.gl.RGBA,this.gl.FLOAT,null),this.gl.texParameterf(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameterf(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameterf(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE);const s=this.gl.createFramebuffer();this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,s),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,e,0);const r=this.gl.createRenderbuffer();this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,r),this.gl.renderbufferStorage(this.gl.RENDERBUFFER,this.gl.DEPTH_COMPONENT16,t,i),this.gl.framebufferRenderbuffer(this.gl.FRAMEBUFFER,this.gl.DEPTH_ATTACHMENT,this.gl.RENDERBUFFER,r);const a=this.gl.checkFramebufferStatus(this.gl.FRAMEBUFFER);if(a!==this.gl.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer object is incomplete: "+a.toString());return[s,e]}}},421:(t,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.isKeyDown=i.isKeyPress=i.initKeyBuffer=void 0;const e=256,s=Array(e).fill(0);function r(t){t.keyCode>=e||(s[t.keyCode]=1,t.preventDefault())}function a(t){t.keyCode>=e||(s[t.keyCode]=0,t.preventDefault())}i.initKeyBuffer=function(){window.addEventListener("keydown",r,!1),window.addEventListener("keyup",a,!1)},i.isKeyPress=function(t){const i=s[t];return s[t]=0,i},i.isKeyDown=function(t){return s[t]}},921:(t,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.rad=i.smoothstep=void 0,i.smoothstep=function(t,i,e){if(e<t)return 0;if(e>=i)return 1;const s=(e-t)/(i-t);return s*s*(3-2*s)},i.rad=function(t){return Math.PI*t/180}},100:(t,i,e)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.NoiseSampler=void 0;const s=e(193);i.NoiseSampler=class{constructor(t){const i=document.createElement("canvas");i.width=t.width,i.height=t.height;const e=i.getContext("2d");e.drawImage(t,0,0,t.width,t.height),this._data=e.getImageData(0,0,i.width,i.height)}getSample(t){const i=t.fract(),e=Math.floor(i.x*this._data.width),s=Math.floor(i.y*this._data.height);return this._data.data[s*this._data.width+e<<2]/255}noiseD(t){const i=t.floor(),e=t.copy().subMutable(i),r=new s.Vec2(3,3).subMutable(e.mul(2)).mulElMutable(e).mulElMutable(e),a=new s.Vec2(1,1).subMutable(e).mulElMutable(e).mulMutable(6),n=this.getSample(new s.Vec2(.5,.5).addMutable(i).divMutable(256)),h=this.getSample(new s.Vec2(1.5,.5).addMutable(i).divMutable(256)),o=this.getSample(new s.Vec2(.5,1.5).addMutable(i).divMutable(256)),l=this.getSample(new s.Vec2(1.5,1.5).addMutable(i).divMutable(256));return{value:n+(h-n)*r.x+(o-n)*r.y+(n-h-o+l)*r.x*r.y,derivative:new s.Vec2(a.x*(r.y*(n-h-o+l)+h-n),a.y*(r.x*(n-h-o+l)+o-n))}}}},704:(t,i,e)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.Quaternion=void 0;const s=e(193);class r extends s.Vec4{invert(){return new r(-this.x,-this.y,-this.z,this.w).divMutable(this.dot(this))}qmul(t){return new r(this.w*t.x+this.x*t.w+this.y*t.z-this.z*t.y,this.w*t.y+this.y*t.w+this.z*t.x-this.x*t.z,this.w*t.z+this.z*t.w+this.x*t.y-this.y*t.x,this.w*t.w-this.x*t.x-this.y*t.y-this.z*t.z)}rotate(t){const i=new r(t.x,t.y,t.z,0),e=this.qmul(i).qmul(this.invert());return new s.Vec3(e.x,e.y,e.z)}mat3(){return new s.Mat3(this.rotate(s.Vec3.I()),this.rotate(s.Vec3.J()),this.rotate(s.Vec3.K()))}static byAngle(t,i){const e=.5*i,s=t.mul(Math.sin(e));return new r(s.x,s.y,s.z,Math.cos(e))}static byYawPitchRoll(t,i,e){return r.byAngle(s.Vec3.I(),i).qmul(r.byAngle(s.Vec3.J(),t).qmul(r.byAngle(s.Vec3.K(),e)))}}i.Quaternion=r,r.Identity=()=>new r(0,0,0,1)},240:(t,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.preprocess=void 0,i.preprocess=async function t(i,e,s=0){if(s>10)throw new Error("Превышено возможное количество уровней вложения модулей программы");const r=(await async function(t){let i=await fetch(t);return await i.text()}(i+"/"+e)).split("\n").map((async e=>{if(e.startsWith("#include")){const[r,a]=e.split(/\s/,2);return await t(i,a.replace(/["']/g,""),s+1)}return e}));return(await Promise.all(r)).join("\n")}},385:(t,i,e)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.Sky=void 0;const s=e(704),r=e(193),a=e(421),n=.12*Math.PI;i.Sky=class{constructor(){this.quat=s.Quaternion.byAngle(r.Vec3.I(),.5*Math.PI),this.axis=new r.Vec3(0,Math.cos(n),-Math.sin(n)),this.period=1200,this.sunDir=new r.Vec3(0,-Math.sin(n),-Math.cos(n)),this.orientation=s.Quaternion.Identity(),this.transformMat=r.Mat3.ID(),this.isShowConstellations=!1,this.sunDirection=this.sunDir.copy()}loopCalculation(t,i){this.orientation=s.Quaternion.byAngle(this.axis,-2*Math.PI*(.25+t/this.period)),this.transformMat=this.orientation.qmul(this.quat).mat3(),this.sunDirection=this.orientation.rotate(this.sunDir).normalize(),(0,a.isKeyPress)(67)>0&&(this.isShowConstellations=!this.isShowConstellations)}}},270:(t,i,e)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.TerrainSampler=void 0;const s=e(24),r=e(921),a=e(193),n=new a.Mat2(new a.Vec2(.8,-.6),new a.Vec2(.6,.8)),h=3e3,o=1100;i.TerrainSampler=class{constructor(t){this._noiseSampler=t}terrainH(t){let i=t.div(h),e=0,s=1;const r=a.Vec2.ZERO();for(let t=0;t<16;t++){const t=this._noiseSampler.noiseD(i);r.addMutable(t.derivative),e+=s*t.value/(1+r.dot(r)),s*=.5,i=n.mul(i.add(i))}return o*e}terrainM(t){let i=t.div(h),e=0,s=1;const r=a.Vec2.ZERO();for(let t=0;t<9;t++){const t=this._noiseSampler.noiseD(i);r.addMutable(t.derivative),e+=s*t.value/(1+r.dot(r)),s*=.5,i=n.mul(i.add(i))}return o*e}terrainS(t){let i=t.div(h),e=0,s=1;const r=a.Vec2.ZERO();for(let t=0;t<5;t++){const t=this._noiseSampler.noiseD(i);r.addMutable(t.derivative),e+=s*t.value/(1+r.dot(r)),s*=.5,i=n.mul(i.add(i))}return o*e}calcNormalM(t,i){const e=new a.Vec2(.001*i,0);return new a.Vec3(this.terrainM(new a.Vec2(t.x-e.x,t.z-e.y))-this.terrainM(new a.Vec2(t.x+e.x,t.z+e.y)),2*e.x,this.terrainM(new a.Vec2(t.x-e.y,t.z-e.x))-this.terrainM(new a.Vec2(t.x+e.y,t.z+e.x))).normalize()}softShadow(t,i){let e=1,n=.1;const h=Math.sqrt(1-i.z*i.z);for(let o=0;o<200;o++){const o=t.add(i.mul(n));if(o.y>1980)return(0,r.smoothstep)(-s.SUN_DISC_ANGLE_SIN,s.SUN_DISC_ANGLE_SIN,e);const l=o.y-this.terrainM(new a.Vec2(o.x,o.z));if(e=Math.min(e,h*l/n),e<-s.SUN_DISC_ANGLE_SIN)return(0,r.smoothstep)(-s.SUN_DISC_ANGLE_SIN,s.SUN_DISC_ANGLE_SIN,e);n+=Math.max(1,.6*Math.abs(l))}return 0}}},193:(t,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.Mat2=i.Vec2=i.Mat3=i.Vec3=i.Mat4=i.Vec4=void 0;class e{constructor(t,i,e,s){this.x=t,this.y=i,this.z=e,this.w=s}addMutable(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}subMutable(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}mulMutable(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}divMutable(t){return this.x/=t,this.y/=t,this.z/=t,this.w/=t,this}mulElMutable(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}divElMutable(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this.w/=t.w,this}normalizeMutable(){return this.divMutable(Math.sqrt(this.dot(this)))}add(t){return this.copy().addMutable(t)}sub(t){return this.copy().subMutable(t)}mul(t){return this.copy().mulMutable(t)}div(t){return this.copy().divMutable(t)}mulEl(t){return this.copy().mulElMutable(t)}divEl(t){return this.copy().divElMutable(t)}normalize(){return this.copy().normalizeMutable()}length(){return Math.sqrt(this.dot(this))}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}copy(){return new e(this.x,this.y,this.z,this.w)}floor(){return new e(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z),Math.floor(this.w))}fract(){return this.copy().subMutable(this.floor())}getArray(){return[this.x,this.y,this.z,this.w]}}i.Vec4=e,e.ZERO=()=>new e(0,0,0,0),e.ONE=()=>new e(1,1,1,1),e.I=()=>new e(1,0,0,0),e.J=()=>new e(0,1,0,0),e.K=()=>new e(0,0,1,0),e.L=()=>new e(0,0,0,1);class s{constructor(t,i,e,s){this.i=t.copy(),this.j=i.copy(),this.k=e.copy(),this.l=s.copy()}mulLeft(t){return new e(this.i.dot(t),this.j.dot(t),this.k.dot(t),this.l.dot(t))}mul(t){return new e(t.x*this.i.x+t.y*this.j.x+t.z*this.k.x+t.w*this.l.x,t.x*this.i.y+t.y*this.j.y+t.z*this.k.y+t.w*this.l.y,t.x*this.i.z+t.y*this.j.z+t.z*this.k.z+t.w*this.l.z,t.x*this.i.w+t.y*this.j.w+t.z*this.k.w+t.w*this.l.w)}getArray(){return[this.i.x,this.i.y,this.i.z,this.i.w,this.j.x,this.j.y,this.j.z,this.j.w,this.k.x,this.k.y,this.k.z,this.k.w,this.l.x,this.l.y,this.l.z,this.l.w]}static orthoProjectMatrix(t,i,r,a,n,h){return new s(new e(2/(i-t),0,0,-(i+t)/(i-t)),new e(0,2/(a-r),0,-(a+r)/(a-r)),new e(0,0,-2/(h-n),-(h+n)/(h-n)),new e(0,0,0,1))}static perspectiveProjectMatrix(t,i,r,a){return new s(new e(1/Math.tan(.5*t),0,0,0),new e(0,i/Math.tan(.5*t),0,0),new e(0,0,-(a+r)/(a-r),-2*a*r/(a-r)),new e(0,0,-1,0))}}i.Mat4=s,s.ID=()=>new s(e.I(),e.J(),e.K(),e.L()),s.ZERO=()=>new s(e.ZERO(),e.ZERO(),e.ZERO(),e.ZERO());class r{constructor(t,i,e){this.x=t,this.y=i,this.z=e}addMutable(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}subMutable(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}mulMutable(t){return this.x*=t,this.y*=t,this.z*=t,this}divMutable(t){return this.x/=t,this.y/=t,this.z/=t,this}mulElMutable(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}divElMutable(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}normalizeMutable(){return this.divMutable(Math.sqrt(this.dot(this)))}safeNormalize(){const t=Math.sqrt(this.dot(this));return t<Number.MIN_VALUE?r.ZERO():this.div(t)}colorNormalize(){const t=Math.max(this.x,this.y,this.z);return t<Number.MIN_VALUE?r.ZERO():this.div(t)}add(t){return this.copy().addMutable(t)}sub(t){return this.copy().subMutable(t)}mul(t){return this.copy().mulMutable(t)}div(t){return this.copy().divMutable(t)}mulEl(t){return this.copy().mulElMutable(t)}divEl(t){return this.copy().divElMutable(t)}normalize(){return this.copy().normalizeMutable()}length(){return Math.sqrt(this.dot(this))}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}copy(){return new r(this.x,this.y,this.z)}floor(){return new r(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z))}fract(){return this.copy().subMutable(this.floor())}exp(){return new r(Math.exp(this.x),Math.exp(this.y),Math.exp(this.z))}getArray(){return[this.x,this.y,this.z]}cross(t){return new r(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)}}i.Vec3=r,r.ZERO=()=>new r(0,0,0),r.ONE=()=>new r(1,1,1),r.I=()=>new r(1,0,0),r.J=()=>new r(0,1,0),r.K=()=>new r(0,0,1);class a{constructor(t,i,e){this.i=t.copy(),this.j=i.copy(),this.k=e.copy()}mulLeft(t){return new r(this.i.dot(t),this.j.dot(t),this.k.dot(t))}mul(t){return new r(t.x*this.i.x+t.y*this.j.x+t.z*this.k.x,t.x*this.i.y+t.y*this.j.y+t.z*this.k.y,t.x*this.i.z+t.y*this.j.z+t.z*this.k.z)}getArray(){return[this.i.x,this.i.y,this.i.z,this.j.x,this.j.y,this.j.z,this.k.x,this.k.y,this.k.z]}}i.Mat3=a,a.ID=()=>new a(r.I(),r.J(),r.K()),a.ZERO=()=>new a(r.ZERO(),r.ZERO(),r.ZERO());class n{constructor(t,i){this.x=t,this.y=i}addMutable(t){return this.x+=t.x,this.y+=t.y,this}subMutable(t){return this.x-=t.x,this.y-=t.y,this}mulMutable(t){return this.x*=t,this.y*=t,this}divMutable(t){return this.x/=t,this.y/=t,this}mulElMutable(t){return this.x*=t.x,this.y*=t.y,this}divElMutable(t){return this.x/=t.x,this.y/=t.y,this}normalizeMutable(){return this.divMutable(Math.sqrt(this.dot(this)))}add(t){return this.copy().addMutable(t)}sub(t){return this.copy().subMutable(t)}mul(t){return this.copy().mulMutable(t)}div(t){return this.copy().divMutable(t)}mulEl(t){return this.copy().mulElMutable(t)}divEl(t){return this.copy().divElMutable(t)}normalize(){return this.copy().normalizeMutable()}length(){return Math.sqrt(this.dot(this))}dot(t){return this.x*t.x+this.y*t.y}copy(){return new n(this.x,this.y)}floor(){return new n(Math.floor(this.x),Math.floor(this.y))}fract(){return this.copy().subMutable(this.floor())}getArray(){return[this.x,this.y]}cross(t){return this.x*t.y-this.y*t.x}}i.Vec2=n,n.ZERO=()=>new n(0,0),n.ONE=()=>new n(1,1),n.I=()=>new n(1,0),n.J=()=>new n(0,1);class h{constructor(t,i){this.i=t.copy(),this.j=i.copy()}mulLeft(t){return new n(this.i.dot(t),this.j.dot(t))}mul(t){return new n(t.x*this.i.x+t.y*this.j.x,t.x*this.i.y+t.y*this.j.y)}getArray(){return[this.i.x,this.i.y,this.j.x,this.j.y]}}i.Mat2=h,h.ID=()=>new h(n.I(),n.J()),h.ZERO=()=>new h(n.ZERO(),n.ZERO())},237:(t,i,e)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.ProgramA=void 0;const s=e(193);i.ProgramA=class{constructor(t,i,e){this.numX=240,this.numY=120,this.engine=t,this.bufferInput=i,this.camera=e}init(t){this.engine.setRenderedTexture(t.program,this.bufferInput.fbTexture,"uTextureProgramB");const i=this.engine.gl.getUniformLocation(t.program,"uTextureBResolution");this.engine.gl.uniform2f(i,this.bufferInput.width,this.bufferInput.height);const e=this.engine.gl.getUniformLocation(t.program,"uNetResolution");this.engine.gl.uniform2f(e,this.numX,this.numY),this.uProjectMatrix=this.engine.gl.getUniformLocation(t.program,"uProjectMatrix"),this.uTransformMatrix=this.engine.gl.getUniformLocation(t.program,"uTransformMatrix"),this.uTransformMatrixPrev=this.engine.gl.getUniformLocation(t.program,"uTransformMatrixPrev"),this.uPositionDelta=this.engine.gl.getUniformLocation(t.program,"uPositionDelta"),this.uCameraViewAngle=this.engine.gl.getUniformLocation(t.program,"uCameraViewAngle");const r=[];for(let t=0;t<this.numY+1;t++)for(let i=0;i<this.numX+1;i++)r.push(2*i/this.numX-1),r.push(1-2*t/this.numY);const a=[];for(let t=0;t<this.numY;t++){for(let i=0;i<this.numX+1;i++)a.push(i+t*(this.numX+1)),a.push(i+(t+1)*(this.numX+1));if(t++,t>=this.numY)break;for(let i=this.numX;i>=0;i--)a.push(i+t*(this.numX+1)),a.push(i+(t+1)*(this.numX+1))}this.engine.setVertexArray(t,"aVertexPosition",r,a,2),t.clearColor=new s.Vec4(0,0,0,0)}update(){const t=this.bufferInput.width/this.bufferInput.height;this.engine.gl.uniformMatrix4fv(this.uProjectMatrix,!1,s.Mat4.perspectiveProjectMatrix(this.camera.viewAngle,t,.5,65e3).getArray()),this.engine.gl.uniformMatrix3fv(this.uTransformMatrixPrev,!1,this.camera.transformMatPrev.getArray()),this.engine.gl.uniformMatrix3fv(this.uTransformMatrix,!1,this.camera.transformMat.getArray()),this.engine.gl.uniform3fv(this.uPositionDelta,this.camera.positionDelta.getArray()),this.engine.gl.uniform1f(this.uCameraViewAngle,this.camera.viewAngle)}}},386:(t,i,e)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.ProgramB=void 0;const s=e(24),r=e(193);i.ProgramB=class{constructor(t,i,e,s,r,a,n){this.infoRefreshTime=0,this.engine=t,this.bufferInput=i,this.camera=e,this.atm=s,this.sky=r,this.flare1=a,this.flare2=n}init(t,i,e,r){this.engine.setRenderedTexture(t.program,this.bufferInput.fbTexture,"uTextureProgramA");const a=this.engine.gl.getUniformLocation(t.program,"uTextureAResolution");this.engine.gl.uniform2f(a,this.bufferInput.width,this.bufferInput.height),this.cameraPositionLocation=this.engine.gl.getUniformLocation(t.program,"uCameraPosition"),this.cameraViewAngleLocation=this.engine.gl.getUniformLocation(t.program,"uCameraViewAngle"),this.cameraVelocityLocation=this.engine.gl.getUniformLocation(t.program,"uCameraVelocity"),this.cameraDirectionLocation=this.engine.gl.getUniformLocation(t.program,"uCameraDirection"),this.cameraTransformMatLocation=this.engine.gl.getUniformLocation(t.program,"uTransformMat"),this.cameraAngularSpeedLocation=this.engine.gl.getUniformLocation(t.program,"uCameraRotationSpeed"),this.cameraInShadowLocation=this.engine.gl.getUniformLocation(t.program,"uCameraInShadow"),this.headLightLocation=this.engine.gl.getUniformLocation(t.program,"uHeadLight"),this.flare1PositionLocation=this.engine.gl.getUniformLocation(t.program,"uFlare1Position"),this.flare1LightLocation=this.engine.gl.getUniformLocation(t.program,"uFlare1Light"),this.flare2PositionLocation=this.engine.gl.getUniformLocation(t.program,"uFlare2Position"),this.flare2LightLocation=this.engine.gl.getUniformLocation(t.program,"uFlare2Light"),this.sunDirectionLocation=this.engine.gl.getUniformLocation(t.program,"uSunDirection"),this.sunDiscColorLocation=this.engine.gl.getUniformLocation(t.program,"uSunDiscColor"),this.sunDiscAngleSinLocation=this.engine.gl.getUniformLocation(t.program,"uSunDiscAngleSin"),this.engine.gl.uniform1f(this.sunDiscAngleSinLocation,s.SUN_DISC_ANGLE_SIN),this.betaRayleighLocation=this.engine.gl.getUniformLocation(t.program,"uBetaRayleigh"),this.engine.gl.uniform3fv(this.betaRayleighLocation,this.atm.betaRayleigh.getArray()),this.betaMieLocation=this.engine.gl.getUniformLocation(t.program,"uBetaMie"),this.engine.gl.uniform3fv(this.betaMieLocation,this.atm.betaMie.getArray()),this.gMieLocation=this.engine.gl.getUniformLocation(t.program,"uGMie"),this.engine.gl.uniform1f(this.gMieLocation,this.atm.g),this.scaleHeightLocation=this.engine.gl.getUniformLocation(t.program,"uScaleHeight"),this.engine.gl.uniform2f(this.scaleHeightLocation,this.atm.heightRayleigh,this.atm.heightMie),this.atmRadiusLocation=this.engine.gl.getUniformLocation(t.program,"uAtmRadius"),this.engine.gl.uniform1f(this.atmRadiusLocation,this.atm.radius),this.planetRadiusLocation=this.engine.gl.getUniformLocation(t.program,"uPlanetRadius"),this.engine.gl.uniform1f(this.planetRadiusLocation,this.atm.planetRadius),this.planetCenterLocation=this.engine.gl.getUniformLocation(t.program,"uPlanetCenter"),this.engine.gl.uniform3fv(this.planetCenterLocation,this.atm.planetCenter.getArray()),this.skyTransformMatLocation=this.engine.gl.getUniformLocation(t.program,"uSkyTransformMat"),this.skyColorLocation=this.engine.gl.getUniformLocation(t.program,"uSkyColor"),this.constellationsColor=this.engine.gl.getUniformLocation(t.program,"uConstellationsColor"),this.screenModeLocation=this.engine.gl.getUniformLocation(t.program,"uScreenMode"),this.mapScaleLocation=this.engine.gl.getUniformLocation(t.program,"uMapScale"),this.engine.setTextureWithMIP(t.program,"uTextureGrayNoise",i),this.engine.setTexture(t.program,"uTextureMilkyway",e),this.engine.setTexture(t.program,"uTextureConstellation",r)}update(t,i){this.engine.gl.uniform4f(this.cameraPositionLocation,this.camera.position.x,this.camera.position.y,this.camera.position.z,this.camera.altitude),this.engine.gl.uniform3fv(this.cameraVelocityLocation,this.camera.velocity.getArray()),this.engine.gl.uniform3fv(this.cameraAngularSpeedLocation,this.camera.angularSpeed.getArray()),this.engine.gl.uniform3fv(this.cameraDirectionLocation,this.camera.direction.getArray()),this.engine.gl.uniformMatrix3fv(this.cameraTransformMatLocation,!1,this.camera.transformMat.getArray()),this.engine.gl.uniform1f(this.cameraViewAngleLocation,this.camera.viewAngle),this.engine.gl.uniform2f(this.screenModeLocation,this.camera.screenMode,this.camera.mapMode),this.engine.gl.uniform1f(this.mapScaleLocation,this.camera.mapScale),this.engine.gl.uniformMatrix3fv(this.skyTransformMatLocation,!1,this.sky.transformMat.getArray()),this.engine.gl.uniform1f(this.constellationsColor,this.sky.isShowConstellations?1:0);const e=this.camera.inShadow(this.atm,this.camera.position,this.sky.sunDirection);if(this.engine.gl.uniform3fv(this.sunDirectionLocation,this.sky.sunDirection.getArray()),this.engine.gl.uniform1f(this.cameraInShadowLocation,e),this.engine.gl.uniform3f(this.headLightLocation,this.camera.headLights,this.camera.headLights,this.camera.headLights),t>this.infoRefreshTime){const i=new r.Vec3(this.camera.position.x,0,this.camera.position.z),e=this.sky.sunDirection.copy();e.y<0&&(e.y=0),e.normalizeMutable();const a=this.atm.scattering(i,e,e),n=s.SUN_COLOR.mul(20),h=(s.SUN_COLOR.mulEl(a.t),n.mulEl(a.t).safeNormalize().mulMutable(2));this.engine.gl.uniform3f(this.sunDiscColorLocation,h.x,h.y,h.z);const o=1/Math.sqrt(2),l=this.atm.scattering(i,r.Vec3.J(),this.sky.sunDirection).t.add(this.atm.scattering(i,new r.Vec3(o,o,0),this.sky.sunDirection).t).add(this.atm.scattering(i,new r.Vec3(-o,o,0),this.sky.sunDirection).t).add(this.atm.scattering(i,new r.Vec3(0,o,o),this.sky.sunDirection).t).add(this.atm.scattering(i,new r.Vec3(0,o,-o),this.sky.sunDirection).t).div(5),u=n.mulEl(l);this.engine.gl.uniform3f(this.skyColorLocation,u.x,u.y,u.z),this.infoRefreshTime=t+.5}this.engine.gl.uniform3fv(this.flare1PositionLocation,this.flare1.position.getArray()),this.flare1.isVisible?this.engine.gl.uniform3fv(this.flare1LightLocation,this.flare1.light.getArray()):this.engine.gl.uniform3f(this.flare1LightLocation,0,0,0),this.engine.gl.uniform3fv(this.flare2PositionLocation,this.flare2.position.getArray()),this.flare2.isVisible?this.engine.gl.uniform3fv(this.flare2LightLocation,this.flare2.light.getArray()):this.engine.gl.uniform3f(this.flare2LightLocation,0,0,0)}}},460:(t,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.loadImage=void 0,i.loadImage=function(t){return new Promise(((i,e)=>{const s=new Image;s.onload=()=>i(s),s.onerror=()=>e(),s.src=t}))}}},i={};(0,function e(s){var r=i[s];if(void 0!==r)return r.exports;var a=i[s]={exports:{}};return t[s](a,a.exports,e),a.exports}(752).Z)()})();